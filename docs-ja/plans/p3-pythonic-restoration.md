# TASK GROUP: TG-P3-PYTHONIC

最終更新: 2026-02-24

関連 TODO:
- `docs-ja/todo/index.md` の `ID: P3-EAST-PY-*`, `P3-PY-*`, `P3-CE-*`

背景:
- selfhost 安定化のため平易化した記法が増え、可読性が低下している。

目的:
- selfhost 安定を維持したまま、段階的に Pythonic 記法へ戻す。

対象:
- `src/pytra/compiler/east_parts/{code_emitter.py,core.py}` の非 Pythonic 記法戻し（先行）
- `src/py2cpp.py` のループ/比較/リテラル/式簡潔化
- `code_emitter.py` の重複判定・分岐整理
- 小パッチ運用（1〜3関数）

非対象:
- 大規模一括リファクタ

受け入れ基準:
- 可読性向上と selfhost 安定を両立
- 既定の検証コマンドを毎回通す
- `P3-EAST-PY-*` 完了までは `P3-PY-*` の新規着手を開始しない（`east_parts` を先行する）

確認コマンド:
- `python3 tools/check_py2cpp_transpile.py`
- `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`

作業ルール:
- 1パッチで戻す範囲は 1〜3 関数に保つ。
- 各パッチで `python3 tools/check_py2cpp_transpile.py` を実行する。
- 各パッチで `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` を実行する。
- 回帰が出た場合は「可読性改善より selfhost 安定」を優先する。

P3-EAST-PY-01 判定結果（最新）:
- `core.py`（戻せる候補）:
  - `_sh_is_identifier`: `while` / 添字走査を `for ch in text[1:]` へ。
  - `_sh_bind_comp_target_types`: `enumerate` 化。
- `core.py`（保留）:
  - 文字列/コメント/文字列リテラル付きの状態機械ループ（`_sh_split_args_with_offsets`, `_sh_parse_augassign`, `_sh_decode_py_string_body`, `_sh_scan_logical_line_state`, `_sh_split_top_keyword`, `_sh_parse_fstring_parts`, `_sh_split_top_level_for/in/assign`, `_sh_split_top_level_call`, `_sh_parse_stmt_block_mutable`）は `while` による状態更新量が大きく、selfhost 影響確認後に段階着手。
- `code_emitter.py`:
  - `_kind_hook_suffix`, `fallback_tuple_target_names_from_repr`, `emit_tuple_assign_with_tmp`: `while i < len(...)` / 添字参照を `for` / `enumerate` 化。

決定ログ:
- 2026-02-24: `P3-EAST-PY-*` を追加し、Pythonic 記法戻しの着手順を `east_parts`（`code_emitter.py` / `core.py`）先行へ変更した。`py2cpp.py` 側は `P3-EAST-PY-*` 完了後に着手する。
- 2026-02-24: `P3-EAST-PY-03-S1` を実施。`code_emitter.py` の `while i < len(...)` 3 関数を `for`/`enumerate` へ置換し、`core.py` の `_sh_is_identifier` と `_sh_bind_comp_target_types` も同時に簡潔化。`python3 tools/check_py2cpp_transpile.py`（`checked=132 ok=132 fail=0 skipped=6`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented --skip-east3-contract-tests`（`mismatches=0 skipped=0`）を通過、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は既知の `east3-contract` 失敗時に停止。
- 2026-02-24: `P3-EAST-PY-03-S2` を実施。`core.py` の `_sh_parse_augassign`, `_sh_split_top_keyword`, `_sh_split_top_level_from`, `_sh_split_top_level_in` を `while i < len(...)` から `for ... enumerate` へ置換し、`python3 tools/check_py2cpp_transpile.py`（`checked=132 ok=132 fail=0 skipped=6`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented --skip-east3-contract-tests`（`mismatches=0 skipped=0`）を通過。
- 2026-02-24: `P3-EAST-PY-03-S3` を実施。`core.py` の `_sh_split_args_with_offsets`, `_sh_split_top_level_colon`, `_sh_has_explicit_line_continuation` を `while i < len(...)` から `for ... enumerate` / `for ... in range(...)` へ置換し、`python3 tools/check_py2cpp_transpile.py`（`checked=132 ok=132 fail=0 skipped=6`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented --skip-east3-contract-tests`（`mismatches=0 skipped=0`）を通過。
- 2026-02-22: 初版作成。
- 2026-02-23: `P3-PY-05` の継続として空文字判定とフォールバック式を簡潔化し、`src/py2cpp.py::CppEmitter.declare_in_current_scope` の `if name == ""` を `if not name` へ、`src/py2cpp.py::CppEmitter.get_expr_type` の `if t != ""` を `if t` へ、`src/py2cpp.py::CppEmitter._infer_module_global_decl_type` の `d2/d1/d0` フォールバックを `d2 or d1 or d0` に統一し `picked = picked if picked != "" else "object"` を `picked = picked or "object"` へ簡潔化した。あわせて `src/py2cpp.py::CppEmitter._collect_module_global_decls` の `if raw_name == ""` を `if not raw_name` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.268.0 -> 0.269.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import モジュール関数シグネチャ読取を簡潔化し、`src/py2cpp.py::CppEmitter._module_function_arg_types` の cache 参照で `fn_map = cached` 一時変数を削除して `sig = cached.get(fn_name)` へ統一した。あわせて空パス判定 `if str(src_path) == ""` を `if not str(src_path)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.267.0 -> 0.268.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として module attribute runtime map 読取の空判定を簡潔化し、`src/py2cpp.py::load_cpp_module_attr_call_map` の `if runtime_name != ""` を `if runtime_name` へ、`if len(mapped) > 0` を `if mapped` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.266.0 -> 0.267.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として module namespace/include 解決の空文字判定を簡潔化し、`src/py2cpp.py::CppEmitter._module_name_to_cpp_namespace` の `if tail != ""`（7箇所）を `if tail` へ、`src/py2cpp.py::CppEmitter._append_runtime_symbol_include` の `if runtime_prefix == "" or symbol == ""` を `if not runtime_prefix or not symbol` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.265.0 -> 0.266.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として runtime C++ ヘッダ存在判定の空文字比較を簡潔化し、`src/py2cpp.py::_runtime_cpp_header_exists_for_module` の `tail != ""` と `rel != ""` 判定を `tail` / `bool(rel)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.264.0 -> 0.265.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import runtime 名解決の空文字判定を簡潔化し、`src/py2cpp.py::CppEmitter._lookup_module_attr_runtime_call` の `if mapped != ""` を `if mapped` へ、`src/py2cpp.py::CppEmitter._resolve_runtime_call_for_imported_symbol` の `if mapped != ""` / `if ns != ""` を truthy 判定へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.263.0 -> 0.264.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` の legacy import symbol 読取をさらに簡潔化し、`legacy_syms` 一時変数を削除して `for local_name, sym_obj in dict_any_get_dict(meta, "import_symbols").items()` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.262.0 -> 0.263.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import runtime 解決をさらに簡潔化し、`mapped_runtime` 一時変数を削除して `mapped_runtime_txt = self._resolve_runtime_call_for_imported_symbol(imported_module, raw) or ""` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.261.0 -> 0.262.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の module namespace 解決をさらに簡潔化し、`imported_module_norm` 一時変数を削除して `self.module_namespace_map.get(self._normalize_runtime_module_name(imported_module), "")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.260.0 -> 0.261.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import runtime 経路を簡潔化し、`merged_args` 一時変数を削除して `call_args = self.merge_call_args(args, kw)` を単一の引数パイプラインとして使う形へ統一した（`_coerce_args_for_module_function` も `call_args` を直接受ける）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.259.0 -> 0.260.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の空文字判定を簡潔化し、`mapped_runtime_txt != ""` を truthy 判定へ、`target_ns != ""` を `if target_ns` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.258.0 -> 0.259.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import 判定条件を簡潔化し、`if raw != "" and not self.is_declared(raw)` を `if raw and not self.is_declared(raw)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.257.0 -> 0.258.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import symbol 解決を簡潔化し、`resolved_name` 一時変数を削除して `raw = dict_str_get(resolved, "name", "") or raw` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.256.0 -> 0.257.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import 解決分岐を簡潔化し、`raw == "" or imported_module == ""` を `if not raw or not imported_module` へ、`mapped_runtime_txt = str(mapped_runtime) if mapped_runtime is not None else ""` を `mapped_runtime or ""` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.255.0 -> 0.256.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の module namespace 解決を簡潔化し、`if imported_module_norm in self.module_namespace_map` + 添字参照を `target_ns = self.module_namespace_map.get(imported_module_norm, "")` + 非空判定へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.254.0 -> 0.255.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py` の末尾アクセスで残っていた手動インデックス参照を縮退し、`_module_tail_to_cpp_header_path` の `leaf_i = len(parts) - 1` / `parts[leaf_i]` を `parts[-1]` へ、`CppEmitter.current_scope_names` / `declare_in_current_scope` の `self.scope_stack[len(...) - 1]` を `self.scope_stack[-1]` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.253.0 -> 0.254.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` の legacy symbol 読取を簡潔化し、`sym = self.any_to_dict_or_empty(sym_obj)` 一時変数を削除して `dict_any_get_str(sym_obj if isinstance(sym_obj, dict) else {}, "...")` 直接読取へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.252.0 -> 0.253.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import symbol 依存収集を簡潔化し、`self.any_to_dict_or_empty(sym_obj)` 一時変数経路を削除して `dict_any_get_str(sym_obj if isinstance(sym_obj, dict) else {}, "module")` へ統一した（module-level 関数内の `self` 参照を除去）。あわせて `test/unit/test_py2cpp_features.py::test_cli_multi_file_from_import_generates_out_include_src` を追加し、`from helper import f` 経路でも `--multi-file` が成功する回帰を固定した。`python3 test/unit/test_py2cpp_features.py Py2CppFeatureTest.test_cli_multi_file_from_import_generates_out_include_src`（1件成功）と `python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.251.0 -> 0.252.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter.emit_assign` の tuple fallback 復元で `for fi in range(len(fallback_names))` + 添字参照を `for nm in fallback_names` へ置換し、`src/py2cpp.py::CppEmitter._fallback_tuple_target_names_from_repr` の識別子検証も `for k in range(len(nm))` + `nm[k:k+1]` から `for k, c in enumerate(nm)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.250.0 -> 0.251.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の legacy fallback 呼び出し重複を縮退し、`_seed_legacy_import_maps_from_meta` helper を追加して末尾フォールバック（symbols/modules）を1箇所へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.249.0 -> 0.250.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_modules_from_meta` の legacy module 読取を簡潔化し、`legacy_mods` 一時変数を削除して `dict_any_get_dict(meta, "import_modules").items()` 直接走査へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.248.0 -> 0.249.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import symbol 読取を簡潔化し、`self.any_to_dict_or_empty(sym_obj)` の重複内包呼び出しを `sym` 1回へ統一した（`module_id = dict_any_get_str(sym, "module")`）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.247.0 -> 0.248.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` の legacy symbol 正規化を簡潔化し、`self.any_to_dict_or_empty(sym_obj)` の重複呼び出しを `sym` 1回へ統一した（`dict_any_get_str(sym, "module"/"name")`）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.246.0 -> 0.247.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter.render_boolop` の逆順値選択組み立てを `for i in range(len(value_nodes) - 2, -1, -1)` + `value_nodes[i]` / `value_texts[i]` から直接反復（`for value_node, cur in zip(reversed(value_nodes[:-1]), reversed(value_texts[:-1]))`）へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.245.0 -> 0.246.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter.is_declared` の逆順スコープ走査を `for i in range(len(self.scope_stack) - 1, -1, -1)` + `self.scope_stack[i]` から直接反復（`for scope in reversed(self.scope_stack)`）へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.244.0 -> 0.245.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._render_repr_expr` の比較連鎖組み立てを `for i in range(len(cmp_terms) - 1)` + `cmp_terms[i]` / `cmp_terms[i + 1]` から直接反復（`for term in cmp_terms`）へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.243.0 -> 0.244.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._fallback_tuple_target_names_from_repr` の `repr_txt` 文字走査を `for i in range(len(repr_txt))` + `repr_txt[i : i + 1]` から `for ch in repr_txt` へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.242.0 -> 0.243.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter.transpile` の `module_defs` 走査を `for i in range(len(module_defs))` + `module_defs[i]` から `for stmt in module_defs` へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.241.0 -> 0.242.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_runtime_output_rel_tail` の末尾要素処理を簡潔化し、`if len(parts) > 0` / `parts[len(parts)-1]` / 再代入を `if parts` / `parts[-1]` へ統一した（`_impl -> -impl` 変換の挙動は維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.240.0 -> 0.241.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_header_allows_none_default` の union 判定走査を `for i in range(len(parts))` + `parts[i]` から `for part in parts` へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.239.0 -> 0.240.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_header_guard_from_path` の文字走査を `for i in range(len(src))` + `src[i:i+1]` から `for ch in src` へ置換し、手動インデックス参照を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.238.0 -> 0.239.0` へ更新した。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_header_guard_from_path` の先頭アンダースコア除去を手動 `while out.startswith("_")` から `lstrip("_")` へ置換し、文字列更新ループを縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.237.0 -> 0.238.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 分岐を整理し、`binding_kind` 読み取り（`dict_str_get(item, "binding_kind", "")`）をループ内で1回に統一した。これにより `module`/`symbol` 分岐の重複参照を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.236.0 -> 0.237.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` の legacy import symbol 反映を簡潔化し、`sym = self.any_to_dict_or_empty(sym_obj)` 一時変数を削除して `dict_any_get_str(self.any_to_dict_or_empty(sym_obj), "...")` 直接参照へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.235.0 -> 0.236.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 分岐を簡潔化し、`has_refs = bool(refs)` 中間変数を削除して `binding_kind == "symbol"` 分岐条件を `and not refs` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.234.0 -> 0.235.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import グラフ解析と multi-file 依存収集の空文字分岐を簡潔化し、`src/py2cpp.py::_analyze_import_graph` では `module_id = resolved_mod_id if ... else ...` を `resolved_mod_id or mod` へ、`src/py2cpp.py::_write_multi_file_cpp` では `module_id_obj != ""` / `module_id != ""` 判定を truthy 判定へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.233.0 -> 0.234.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の include 追加処理をさらに簡潔化し、canonical `import_bindings`・fallback `Import`・`ImportFrom` の3経路で `inc` / `mod_name` 一時変数展開を縮退した（`append_unique_non_empty(..., self._module_name_to_cpp_include(...))` へ統一）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.232.0 -> 0.233.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の import 読取をさらに簡潔化し、`ImportFrom` 分岐の `mod_name` 二段代入を `self._normalize_runtime_module_name(dict_any_get_str(...))` の1段へ統一した。あわせて canonical/fallback 両経路の戻り値整形（`includes = sort_str_list_copy(includes); return includes`）を `return sort_str_list_copy(includes)` へ縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.231.0 -> 0.232.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の import 解析で一時変数展開をさらに縮退し、`CppEmitter._collect_import_cpp_includes` は canonical `import_bindings` 走査で `module_id` / `binding_kind` の中間変数を削除、`CppEmitter._seed_import_maps_from_meta` は `binding_kind` のローカル保持をやめて `dict_str_get(..., "binding_kind", "")` 直接比較へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.230.0 -> 0.231.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の import 束縛分岐を簡潔化し、`CppEmitter._emit_noop_stmt` の `names` 取得を分岐外へ共通化、`asname` fallback 判定を truthy 形式へ統一した。あわせて `CppEmitter._seed_import_maps_from_meta` は `has_refs = bool(refs)` を導入して `binding_kind == "symbol"` 分岐の条件を `not has_refs` へ明示化した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.229.0 -> 0.230.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt` の `Import` 分岐で `local_name != ""` の事前チェックを削除し、`set_import_module_binding` の `module_id` ガードへ一本化した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.228.0 -> 0.229.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の import 解析分岐をさらに縮退し、`CppEmitter._collect_import_cpp_includes` の canonical/fallback 両経路で symbol 名の空判定を helper（`_append_runtime_symbol_include`）へ委譲、`CppEmitter._seed_import_maps_from_meta` では `if refs:` 包みを削除して `refs` 直接走査へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.227.0 -> 0.228.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 反映ループで、`module_id/export_name/local_name` 一時変数展開を縮退し、`set_import_module_binding` / `set_import_symbol_binding_and_module_set` へ `dict_str_get(...)` を直接渡す形へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.226.0 -> 0.227.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._append_runtime_symbol_include` を追加し、`_collect_import_cpp_includes` の canonical / fallback 両経路に散在していた runtime symbol include 追加処理（prefix 判定 + include 解決 + unique append）を helper 呼び出しへ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.225.0 -> 0.226.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt` の import 束縛更新を簡潔化し、`Import` は `local_name = asname or _last_dotted_name(name)`、`ImportFrom` は `local_name = asname or name` を1回計算して `set_import_*` 呼び出しを単一路線に統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.224.0 -> 0.225.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import 束縛の空文字ガード重複を削減し、`src/py2cpp.py::CppEmitter._collect_import_cpp_includes` から `if module_id != ""` を除去、`CppEmitter._seed_import_maps_from_meta` の `binding_kind == "symbol"` 分岐から `export_name != ""` を除去、`CppEmitter._emit_noop_stmt` の `Import/ImportFrom` で `name/mod` 空文字チェックを helper 側（`set_import_*`）へ委譲した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.223.0 -> 0.224.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 分岐で `len(bindings)` / `len(refs)` 判定を真偽値判定（`if bindings`, `if refs`, `and not refs`）へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.222.0 -> 0.223.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._runtime_symbol_module_prefix` を追加し、`_collect_import_cpp_includes` の canonical / fallback 両分岐に残っていた `pytra.std` / `pytra.utils` prefix 判定ロジックを helper 経由へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.221.0 -> 0.222.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 適用で、`meta_qualified_symbol_refs/meta_import_bindings` が既に正規化済みであることを前提に重複していた空文字バリデーション分岐（`if module_id != "" ...` / `if module_id == "" or local_name == ""`）を削除した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.220.0 -> 0.221.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import 解析系の分岐を簡潔化し、`src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の `if len(bindings) > 0` を `if bindings` へ、`CppEmitter._seed_import_maps_from_meta` の legacy fallback 判定 `if len(self.import_symbols/modules) == 0` を `if not self.import_symbols/modules` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.219.0 -> 0.220.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の canonical import_binding 分岐でも `pytra.std` / `pytra.utils` の symbol include 追加処理を `runtime_prefix` 経由へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.218.0 -> 0.219.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の import `names` 正規化をさらに縮退し、`CppEmitter._import_entries_for_stmt` を削除して `self._dict_stmt_list(stmt.get("names"))` へ一本化した（`_collect_import_cpp_includes` / `_emit_noop_stmt` の両方）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.217.0 -> 0.218.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import メタ読取を `dict_any_get_dict_list(..., "qualified_symbol_refs"/"import_bindings")` から `meta_qualified_symbol_refs(self.doc)` / `meta_import_bindings(self.doc)` へ統一し、ループ内のキー読取も `dict_str_get(...)` へ寄せた。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.216.0 -> 0.217.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の `ImportFrom` 分岐で重複していた `pytra.std` / `pytra.utils` の symbol include 追加処理を `runtime_prefix` 経由の単一ループへ統合した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.215.0 -> 0.216.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として import `names` 正規化 helper を `src/py2cpp.py::CppEmitter._import_entries_for_stmt` としてクラスメソッド化し、`_emit_noop_stmt` と `_collect_import_cpp_includes` で共有する構成へ整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.214.0 -> 0.215.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt` の `Import/ImportFrom` で重複していた `names` 正規化（`_dict_stmt_list` 失敗時の `any_to_list` fallback）をローカル helper `_import_entries_for_stmt` へ共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.213.0 -> 0.214.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import 依存モジュール収集ループを `items()` から `values()` 走査へ整理し、未使用 alias 変数（`_alias_any`）を削除した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.212.0 -> 0.213.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の canonical import binding 読取を `self._dict_stmt_list(meta.get("import_bindings"))` から `dict_any_get_dict_list(meta, "import_bindings")` へ統一し、`_seed_legacy_import_symbols_from_meta` では `module_id/symbol` 一時変数を削減して helper 呼び出しへ直接渡す形に整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.211.0 -> 0.212.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import 依存モジュール抽出で、`module_id = ... if isinstance(...)` と `sym = ...` の一時変数展開を縮退し、`import_modules` は条件付き直接追加、`import_symbols` は `dict_any_get_str(self.any_to_dict_or_empty(sym_obj), "module")` 経由へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.210.0 -> 0.211.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` と `CppEmitter.transpile` の `meta` 読取で、`any_to_dict_or_empty(self.doc.get("meta"))` を `dict_any_get_dict(self.doc, "meta")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.209.0 -> 0.210.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` / `_seed_legacy_import_modules_from_meta` の legacy import メタ読取で、`any_to_dict_or_empty(meta.get(...))` 展開を `dict_any_get_dict(meta, "...")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.208.0 -> 0.209.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import メタ読取で、`self.any_to_dict_list(meta.get(...))` 展開を `dict_any_get_dict_list(meta, "...")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.207.0 -> 0.208.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_modules_from_meta` の legacy import module 束縛で中間変数 `module_id` を削除し、`set_import_module_binding(..., self.any_to_str(module_id_any))` へ直接渡す形に簡潔化した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.206.0 -> 0.207.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の import 参照エラー判定経路（`_render_attribute_expr` 内）で、`base_name = any_to_str(base_node.get("id"))` を `dict_any_get_str(base_node, "id")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.205.0 -> 0.206.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_make_missing_symbol_import_error` の `source_path` 読取を整理し、`src_obj = ...; isinstance(...)` 展開を `dict_any_get_str(self.doc, "source_path", "(input)")` + 空文字 fallback へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.204.0 -> 0.205.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_render_call_name_or_attr` の `Call(Name)` 分岐で、`raw = any_to_str(fn.get("id"))` を `dict_any_get_str(fn, "id")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.203.0 -> 0.204.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_is_reexport_assign` の import 再エクスポート判定を整理し、`any_to_str(value.get("id"))` / `any_to_str(owner.get("id"))` 展開を `dict_any_get_str(...)` へ統一、`owner` 抽出も `dict_any_get_dict(...)` へ寄せた。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.202.0 -> 0.203.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の `Call(Name)` import 解決経路を簡潔化し、`_resolve_or_render_imported_symbol_name_call` の `mapped_runtime` 文字列化を条件式代入へ統一、`_render_call_name_or_attr` では `resolved[0]/resolved[1]` 展開を tuple 受け取りへ縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.201.0 -> 0.202.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._resolve_or_render_imported_symbol_name_call` の import シンボル解決で、`resolved["module"/"name"] if ...` 展開を `dict_str_get(...)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.200.0 -> 0.201.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt` の import 束縛更新（`Import` / `ImportFrom`）を整理し、`any_to_str(ent.get(...))` / `any_to_str(stmt.get("module"))` 展開を `dict_any_get_str(...)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.199.0 -> 0.200.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` の import 読取（`meta.import_bindings` / `Import` / `ImportFrom`）を整理し、`any_to_str(item.get(...))` 展開を `dict_any_get_str(...)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.198.0 -> 0.199.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の canonical import 読取（`qualified_symbol_refs` / `import_bindings`）を整理し、`any_to_str(item.get(...))` 展開を `dict_any_get_str(...)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.197.0 -> 0.198.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_legacy_import_symbols_from_meta` / `_seed_legacy_import_modules_from_meta` の legacy import 読取を整理し、`sym.get(...)+any_to_str(...)` 展開を `dict_any_get_str(...)` + `module_id/symbol` 正規化へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.196.0 -> 0.197.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import 依存モジュール抽出を整理し、`import_modules` 側の `module_id_obj` 判定を `module_id` 正規化へ統一、`import_symbols` 側も `sym_obj` 直参照を `sym` + `dict_any_get_str(sym, "module")` 経路へ縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.195.0 -> 0.196.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_analyze_import_graph` の user module 解決で、`dep_file = Path("")` 初期化 + `str(dep_file) == ""` 判定を `dep_txt == ""` 早期判定へ整理し、edge 追加時の `cur_adj` 一時変数も `graph_adj[cur_key].append(dep_key)` へ縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.194.0 -> 0.195.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の module 走査で未使用値 `_east_obj` を廃止し（`for mod_key in module_east_map`）、依存 module namespace 解決（`module_ns_map`）も `in` + 添字参照から `get(..., "")` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.193.0 -> 0.194.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の依存モジュール解決で、`module_name_by_key` 線形探索を `module_key_by_name` 辞書へ置換した（同一 `mod_name` は最初の module key を保持）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.192.0 -> 0.193.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import 依存モジュール抽出で、`mod_name` 一時変数と `dict_any_get_str(...)` 再呼び出しを削減し、`import_modules/import_symbols` の `items()` 値側（`module_id_obj`）を直接判定する経路へ整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.191.0 -> 0.192.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の forward 宣言生成で、`funcs.items()` 走査時の `dict_any_get_dict(funcs, fn_name)` 再lookupを削減し、`fn_sig_obj` 直接利用へ整理した（非文字列 key は早期 `continue`）。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.190.0 -> 0.191.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の依存モジュール前方宣言解決で、`module_east_map.items()` 走査（値破棄 `_ = p2`）を廃止し、`module_name_by_key.items()` 直接走査へ整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.189.0 -> 0.190.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import メタ読取で、`import_modules` / `import_symbols` の再lookup（`dict_any_get_*`）と alias 一時変数依存を縮退し、`items()` の値側（`module_id_obj` / `sym_obj`）から直接 `mod_name` を抽出する経路へ整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.188.0 -> 0.189.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` に残っていた legacy import 読み取り重複を `_seed_legacy_import_symbols_from_meta` / `_seed_legacy_import_modules_from_meta` へ抽出し、`module_id_obj` / `sym_obj` の一時変数展開を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=131 ok=131 fail=0 skipped=6`）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.187.0 -> 0.188.0` へ更新した。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_validate_import_graph_or_raise` の `relative_imports` / `missing_modules` 解析で重複していた `file_part/mod_part` 展開を `_split_graph_issue_entry` helper へ共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.106.0 -> 0.107.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_analyze_import_graph` に残っていた `relative_imports` / `missing_modules` / `edges` 収集時の重複分岐（`not in seen` + `add` + `append`）を、既存 helper `_append_unique_non_empty` 呼び出しへ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.105.0 -> 0.106.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` に残っていた include 追加の重複分岐（`inc/sym_inc` の空文字 + 重複判定）を、既存 helper `_append_unique_non_empty` 呼び出しへ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.104.0 -> 0.105.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_append_unique_non_empty` helper を追加し、`dump_deps_text` と `_collect_import_modules` に散在していた「空文字除外 + 重複除外 + append」分岐を共通化した。これにより import module/symbol ラベル収集の重複条件分岐を縮退した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.103.0 -> 0.104.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::build_module_symbol_index` の legacy import fallback で `module_id` / `symbol` 一時変数展開を縮退し、`_set_import_module_binding` / `_set_import_symbol_binding` へ `_dict_any_get_str(...)` 直接渡しへ整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.102.0 -> 0.103.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._fallback_tuple_target_names_from_repr` の `parts` 走査を index ベース（`for j in range(len(parts))`）から直接反復（`for nm in parts`）へ戻した。文字列本体の文字走査（`for k in range(len(nm))`）は selfhost 安定性を優先して維持した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.101.0 -> 0.102.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::dump_deps_text` と `build_module_symbol_index` の import binding 読取で、`ent["module_id"]` などを一時変数へ展開していた経路を縮退し、`_set_import_module_binding` / `_set_import_symbol_binding` 呼び出しを含めて直接参照中心に整理した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.100.0 -> 0.101.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_extract_function_arg_types_from_python_source` で `fn_names` 一時配列を作って index 走査していた経路を廃止し、`sigs.items()` の直接反復へ戻した。以前見送った `list[str]` 直接反復とは別経路（`dict` 反復）として適用し、selfhost 型崩れを回避した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.99.0 -> 0.100.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt` の `Import` / `ImportFrom` 分岐で重複していた import 束縛更新（`import_modules` 代入、`import_symbols` 代入 + `import_symbol_modules` 登録）を `_set_import_module_binding` / `_set_import_symbol_binding_and_module_set` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.98.0 -> 0.99.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_set_import_symbol_binding_and_module_set` helper を追加し、`CppEmitter._seed_import_maps_from_meta` の canonical/legacy import symbol 束縛で重複していた `import_symbols` 代入 + `import_symbol_modules` 登録を共通化した。あわせて同メソッドの module alias 束縛も `_set_import_module_binding` へ寄せた。初版は helper 内の helper 呼び出しで selfhost C++ の `const` 推論回帰（`dict&` へ束縛不可）を誘発したため、helper 本体を直接代入に修正して解消した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.97.0 -> 0.98.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_set_import_module_binding` / `_set_import_symbol_binding` helper を追加し、`build_module_symbol_index` の import alias 構築（`import_bindings` / `qualified_symbol_refs` / legacy meta）で重複していた map 代入を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.96.0 -> 0.97.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_stmt_assigned_names` helper を追加し、`_module_export_table` と `build_module_symbol_index` の `Assign/AnnAssign` 名抽出重複を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.95.0 -> 0.96.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_stmt_target_name` helper を追加し、`build_cpp_header_from_east`、`_module_export_table`、`build_module_symbol_index` の `target` 由来 `Name` 抽出重複を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.94.0 -> 0.95.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_name_target_id` helper を追加し、`_module_export_table` と `build_module_symbol_index` の `Assign/AnnAssign` で重複していた `Name` 判定 + `id` 抽出を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.93.0 -> 0.94.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` に `_assign_targets` helper を追加し、`_module_export_table` と `build_module_symbol_index` の `Assign` 読取で重複していた `targets/target` fallback 展開を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/build_selfhost.py`（成功）を確認し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `mismatches=3 skipped=0`（既知維持）だった。`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.92.0 -> 0.93.0` へ更新し、`python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_sort_str_list_in_place` の `items` コピー走査を index ベース（`for i in range(len(items))`）から直接反復（`for item in items`）へ戻した。対象は型注釈済み `list[str]` 引数に限定し、既知の `string` 直接反復不安定域は触れていない。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.91.0 -> 0.92.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_collect_import_cpp_includes` の `bindings` 走査を index ベース（`for i in range(len(bindings))`）から直接反復（`for item in bindings`）へ戻した。`list[str]/string` 反復で selfhost 型崩れが起きる既知領域は避け、`_dict_stmt_list(...)` で正規化済みの `list[dict]` のみを対象にした。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.90.0 -> 0.91.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_seed_import_maps_from_meta` の `refs/bindings` 走査を index ベース（`for i in range(len(...))`）から直接反復（`for ref_item in refs` / `for item in bindings`）へ戻した。`list[str]` / `string` 反復で selfhost 型崩れが起きる既知領域は避け、`any_to_dict_list(...)` で正規化済みの `list[dict]` だけを対象にした。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.89.0 -> 0.90.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::transpile`（class method 収集部）の `arg_order` 走査を index ベース（`for ai in range(len(arg_order))`）から直接反復（`for raw_n in arg_order`）へ戻した。`list[str]/list[dict]` の既知不安定域は避け、`list[Any]` 由来の箇所だけを対象にした。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.88.0 -> 0.89.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::render_minmax` と `src/py2cpp.py::_collect_assigned_name_types` の `list[Any]` 添字走査（`for i in range(len(...))`）を直接反復へ戻した。`list[str]/list[dict]` で selfhost 型崩れが出る既知領域は避け、`arg_nodes_safe` / `elements` のみを対象にした。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.87.0 -> 0.88.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_mark_mutated_param_from_target`、`src/py2cpp.py::_render_param_default_expr`、`src/py2cpp.py::_emit_noop_stmt` の `list[Any]` 添字走査（`for i in range(len(...))`）を直接反復へ戻した。`list[str]/list[dict]` で selfhost 型崩れが出る既知領域は避け、`any_to_list` / `any_dict_get_list` 由来のループのみを対象にした。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.86.0 -> 0.87.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_resolve_user_module_path_for_graph` と `src/py2cpp.py::_resolve_user_module_path` の `candidates` 走査を index ベース（`for i in range(len(...))`）から直接反復（`for path_txt, rank in candidates`）へ戻した。あわせて `src/py2cpp.py::_extract_function_arg_types_from_python_source` の直接反復化も試したが、selfhost C++ で `str -> object` 変換エラーを誘発したため取り下げ、selfhost 安定優先で見送った。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.85.0 -> 0.86.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_class_method_sig` と `src/py2cpp.py::_class_method_name_sig` の `candidates` 走査を index ベース（`for i in range(len(...))`）から直接反復へ戻した。`CppEmitter.transpile` の `module_defs` 直接反復も併せて試したが selfhost C++ で `dict -> object` 変換エラーになったため取り下げ、selfhost 安定優先で見送った。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.84.0 -> 0.85.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_analyze_import_graph` の `mods/graph_keys/keys/visited_order` 走査を index ベース（`for i in range(len(...))`）から直接反復へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.83.0 -> 0.84.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::dump_deps_text` の import binding 走査と `modules/symbols` 出力走査を index ベース（`for i in range(len(...))`）から直接反復へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.82.0 -> 0.83.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_module_export_table` と `src/py2cpp.py::_validate_from_import_symbols_or_raise` の `body`/`names` 走査を index ベース（`for i in range(len(...))`）から直接反復へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.81.0 -> 0.82.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_header_render_default_expr` と `src/py2cpp.py::build_cpp_header_from_east` の反復処理（`body`/`arg_order`/`includes`/`class_lines`/`var_lines`/`fn_lines`）を index ベース（`for i in range(len(...))`）から直接反復へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.80.0 -> 0.81.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01`/`P3-PY-04` の継続として `src/py2cpp.py::build_module_type_schema` と `src/py2cpp.py::_write_multi_file_cpp` の反復処理を index ベース（`for i in range(len(...))`）から直接反復（`for x in ...`）へ戻し、`label`/`target_mod_name` の if 代入を条件式へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.79.0 -> 0.80.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::build_module_symbol_index`（legacy import fallback）と `src/py2cpp.py::_write_multi_file_cpp`（import meta 走査）で `dict(...)` 直コピーと緩い要素読取を削減し、`_dict_any_get_str(...)` / `_dict_any_get_dict(...)` ベースの key/値正規化へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3 skipped=0` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.78.0 -> 0.79.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の 2 関数（`_header_render_default_expr`、`build_cpp_header_from_east`）で `obj -> isinstance -> 代入` 展開をさらに縮退し、`_dict_any_get_dict_list` / `_dict_any_get_str` / `_dict_any_get_dict` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.77.0 -> 0.78.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py` の 2 関数（`_header_render_default_expr`、`build_cpp_header_from_east`）で `obj -> isinstance -> 代入` 展開を helper（`_dict_any_get_list` / `_dict_any_get_dict_list` / `_dict_any_get_dict`）経由へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.76.0 -> 0.77.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_emit_local_function_stmt`、`emit_for_each`、`render_expr` の `dict` 推論分岐）で if/else 代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.75.0 -> 0.76.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_python_module_exists_under`、`_module_tail_to_cpp_header_path`、`_runtime_cpp_header_exists_for_module`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.74.0 -> 0.75.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_render_repr_expr`、`render_expr`、`transpile_cli`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.73.0 -> 0.74.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_module_name_from_path_for_graph`、`_module_id_from_east_for_graph`、`_module_name_from_path`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.72.0 -> 0.73.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_resolve_user_module_path_for_graph`、`_sanitize_module_label`、`_resolve_user_module_path`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.71.0 -> 0.72.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_predeclare_if_join_names`、`_emit_annassign_stmt`、`render_expr` の `ListComp/RangeExpr` 分岐）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.70.0 -> 0.71.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_emit_local_function_stmt`、`_emit_target_unpack`、`emit_function`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.69.0 -> 0.70.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_emit_if_stmt`、`_emit_while_stmt`、`build_module_east_map`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.68.0 -> 0.69.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`_infer_module_global_decl_type`、`_emit_annassign_stmt`、`_emit_augassign_stmt`）で if 連鎖代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.67.0 -> 0.68.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-05` の継続として `src/py2cpp.py::_module_export_table` と `build_module_symbol_index` の Assign/AnnAssign 読取で `obj -> isinstance -> 代入` 展開を削減し、`_dict_any_get_dict(...)` / `_dict_any_get_dict_list(...)` 前提の経路へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.66.0 -> 0.67.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-03` の継続として `src/py2cpp.py::load_cpp_profile` の fallback 経路を整理し、`out = {}; out["syntax"] = {}` 形の段階代入を廃止して `{"syntax": {}}` を直接返す形へ変更した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.65.0 -> 0.66.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 関数（`render_boolop`、`emit_for_range`、list comprehension の `RangeExpr` 分岐）で if/else 代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.64.0 -> 0.65.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 箇所（`load_east` の `east_any` 選択、`emit_function` の `param_txt` 選択、`build_cpp_header_from_east` の `param_txt` 選択）で if/else 代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.63.0 -> 0.64.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 箇所（tuple unpack の `decl_t_txt` 選択、CLI の `east_module` 選択、multi-file 分岐の `module_east_map` 選択）で if/else 代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.62.0 -> 0.63.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-04` の継続として `src/py2cpp.py` の 3 箇所（`emit_for_range` の `tgt_ty_txt` 選択、`_rel_disp_for_graph` の `base_prefix` 構築、multi-file header 宣言生成部の `ret_cpp` 選択）で if/else 代入を条件式へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.61.0 -> 0.62.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py` の 2 関数（`_split_top_level_infix_text`、`_replace_all_text`）で外側 `while` を `for range + skip_until` へ置換し、可変ステップ（`i += m`）を維持した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.60.0 -> 0.61.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py` の 2 箇所（`CppEmitter._split_call_repr` の括弧深さ走査、`CppEmitter._replace_all_text` の一致判定内側ループ）で `while` を `for range` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.59.0 -> 0.60.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py` の 2 関数（`_sort_str_list_in_place`、`_graph_cycle_dfs`）で逆順 `while` 走査を `for range` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.58.0 -> 0.59.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py` の 3 関数（`CppEmitter.is_declared`、`CppEmitter.render_boolop`、`CppEmitter.render_expr` の `Dict` 分岐 entries 補完）で `while` 走査を `for range` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 維持）を確認し、`src/pytra/compiler/transpiler_versions.json` の `cpp` を `0.57.0 -> 0.58.0` へ更新して `python3 tools/check_transpiler_version_gate.py`（`[OK] transpiler version bump gate passed`）を通過させた。
- 2026-02-23: `P3-PY-01` の継続として `src/py2cpp.py::_graph_cycle_dfs` の外側 `nxts` 走査を `while i < len(nxts)` から `for nxt in nxts` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=129 ok=129 fail=0 skipped=6`）と `python3 tools/check_transpiler_version_gate.py`（`cpp 0.54.0 -> 0.55.0`）は通過。`python3 tools/build_selfhost.py` は既知の selfhost parser 制約（`unsupported import clause: _modules: dict[str`）で失敗し、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` は `selfhost/py2cpp.out` 不在のため未実施。
- 2026-02-22: `P3-PY-02` の小パッチとして `src/py2cpp.py::_render_set_literal_repr` の `[:1]` / `[-1:]` 判定を `startswith` / `endswith` へ戻した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-02` の継続として `src/py2cpp.py::_emit_target_unpack` の型文字列判定（`list[` / `set[` / `tuple[` / `dict[`）をスライス比較から `startswith` / `endswith` に統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の小パッチとして `src/py2cpp.py::_sanitize_module_label` の手動インデックス `while` ループを `for ch in s` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-02` 周辺の後続整理として `src/py2cpp.py::_cpp_type_text` と `_header_cpp_type_from_east` のクラス名推定で `leaf[:1]` を廃止し、空文字チェック + `leaf[0]` 参照へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_path_parent_text`（区切り探索）と `_make_user_error`（details 連結）の手動インデックス `while` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_module_tail_to_cpp_header_path`、`_parse_user_error`、`_header_guard_from_path` の手動インデックス走査を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `src/py2cpp.py` 全体で `[:1]` / `[-1:]` / `[0:1]` 系の1文字スライス比較パターンが検出ゼロになったため、`P3-PY-02` を完了扱いにした。
- 2026-02-22: `P3-CE-01` の小パッチとして `src/pytra/compiler/east_parts/code_emitter.py` の `escape_string_for_literal`、`render_compare_chain_common`、`load_import_bindings_from_meta` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-02` の小パッチとして `src/pytra/compiler/east_parts/code_emitter.py` に `_is_empty_dynamic_text` を追加し、`any_dict_get_str` / `any_to_str` / `get_expr_type` / `_node_kind_from_dict` の空値判定重複を共通化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-04` の小パッチとして `src/pytra/compiler/east_parts/code_emitter.py` に `_lookup_hook` を追加し、`hook_on_emit_stmt` / `hook_on_emit_stmt_kind` / `hook_on_render_expr_kind` / `hook_on_render_expr_leaf` の hook 取得ロジック重複を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-03` の小パッチとして `src/pytra/compiler/east_parts/code_emitter.py::_emit_trivia_items` から directive/blank 分岐を `_handle_comment_trivia_directive`、`_emit_passthrough_directive_line`、`_emit_blank_trivia_item` に分離した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_split_infix_once` の手動インデックス探索を `str.find` + スライスへ置換し、返却契約（`left/right/found`）を維持した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-01` の継続として `src/pytra/compiler/east_parts/code_emitter.py::load_profile_with_includes` の include 収集/展開ループを `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-04` の継続として `hook_on_stmt_omit_braces` / `hook_on_for_range_mode` / `hook_on_render_call` も `_lookup_hook` 経由へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `src/pytra/compiler/east_parts/code_emitter.py` で `hook_on_*` の `if "on_*" in self.hooks` パターンが検出ゼロになったため `P3-CE-04` を完了扱いにした。`P3-CE-03` も `_emit_trivia_items` の directive 分岐分割が完了したため完了扱いにした。
- 2026-02-22: `P3-CE-02` の継続として `render_name_ref` / `attr_name` の空値判定も `_is_empty_dynamic_text` へ統一し、`code_emitter.py` 内の `{"", "None", "{}", "[]"}` 直接判定を helper 定義箇所のみに集約したため `P3-CE-02` を完了扱いにした。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-CE-01` の継続として `render_constant_common`（bytes repr 引用符探索）の index `while` を `for enumerate` へ置換し、`code_emitter.py` で `while i/j/k < len(...)` パターンが検出ゼロになったため `P3-CE-01` を完了扱いにした。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_split_ws_tokens` と `_first_import_detail_line` の手動 index 走査を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_split_top_level_csv`、`_extract_function_signatures_from_python_source`（params 展開部）、`_extract_function_arg_types_from_python_source` の index `while` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::cpp_string_lit`、`_split_type_args`、`_split_top_level_union` の index `while` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_sort_str_list_in_place`、`CppEmitter.build`（`self.lines` 結合）、`_render_append_like` の index `while` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_coerce_args_for_module_function` と `_coerce_py_assert_args` の `args` 走査を `while` + 手動インデックスから `for enumerate` へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）と `python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）を確認。
- 2026-02-22: `P3-PY-03` の小パッチとして `src/py2cpp.py::_parse_user_error`、`CppEmitter._prepare_call_parts`、`_resolve_module_name_for_graph` の段階的 dict 構築を辞書リテラル返却へ置換した。合わせて selfhost 互換維持のため `_first_import_detail_line` / `_extract_function_arg_types_from_python_source` / `_header_guard_from_path` を `while` ベースへ戻し、`_sort_str_list_in_place` はソート済みコピー返却 + 呼び出し側再代入へ調整した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.1.0 -> 0.2.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::load_cpp_hooks`、`_analyze_import_graph`（戻り値整形部）、`resolve_module_name` の dict 段階構築を辞書リテラル返却へ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.2.0 -> 0.3.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::build_module_symbol_index` の `import_symbols` 要素生成（`module/name`）と module index 返却組み立て（`functions/classes/variables/import_*`）を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.3.0 -> 0.4.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::CppEmitter._seed_import_maps_from_meta` の symbol import エントリ生成（`module/name`）4箇所を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.4.0 -> 0.5.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::_extract_function_signatures_from_python_source`、`_meta_import_bindings`、`_meta_qualified_symbol_refs` の固定キー辞書組み立てを辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.5.0 -> 0.6.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::CppEmitter._emit_noop_stmt`（`ImportFrom` 分岐）の import symbol エントリ生成2箇所（`module/name`）を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.6.0 -> 0.7.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::build_module_type_schema` の `ClassDef` 側 schema 組み立て（`field_types`）と module schema 返却組み立て（`functions/classes`）を辞書リテラル化した（`FunctionDef` 側は selfhost 安定を優先して段階代入のまま維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.7.0 -> 0.8.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::_write_multi_file_cpp` の manifest module エントリ組み立て（`module/label/header/source/is_entry`）を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.8.0 -> 0.9.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::_write_multi_file_cpp` の manifest 初期組み立て（`entry/include_dir/src_dir`）を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.9.0 -> 0.10.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::_write_multi_file_cpp` の manifest 終端組み立て（`modules` 追加と戻り値 `manifest` パス付与）を辞書リテラル化し、`manifest[...]` の段階代入を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.10.0 -> 0.11.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::emit_for_each` の `RangeExpr` 分岐で擬似 `ForRange` ノード（`target/target_type/start/stop/step/range_mode/body/orelse`）の段階代入を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.11.0 -> 0.12.0`）を確認。
- 2026-02-22: `P3-PY-03` の継続として `src/py2cpp.py::emit_assign`（`pseudo_target`/`rec`）、`render_expr`（`Dict` 分岐の `entries`）、`build_module_type_schema`（`fn_ent`）の固定キー辞書の段階代入を辞書リテラル化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.12.0 -> 0.13.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_collect_mutated_params`（引数名収集）と `_allows_none_default`（union 走査）の `while` を `for` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.13.0 -> 0.14.0`）を確認。
- 2026-02-22: `P3-PY-05` の一部として `src/py2cpp.py::_meta_import_bindings`、`_meta_qualified_symbol_refs`、`build_module_symbol_index` の import メタ読取で `meta` / `binds` / `refs` / `import_*_obj2` の一時変数展開を条件式代入へ簡潔化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.14.0 -> 0.15.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_meta_import_bindings`、`_meta_qualified_symbol_refs`、`build_module_symbol_index` の index `while` を段階的に `for` へ置換した。途中で `build_module_symbol_index` の `body_obj` 事前正規化を `for` 化すると selfhost C++ で `begin/end` 解決エラーが出ることを確認し、当該箇所のみ `while` 維持へ戻したうえで `python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.15.0 -> 0.16.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_render_isinstance_name_call` の `rhs` 一時変数初期化（`if len(arg_nodes) > 1`）を条件式代入へ簡潔化した。合わせて `_analyze_import_graph` / `build_module_east_map` の同系簡略化も試行したが selfhost C++ で型回帰（`east_cur` 未宣言・`meta["module_id"]` 代入型不一致）が出たため当該2箇所は元実装へ戻し、`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.16.0 -> 0.17.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_runtime_output_rel_tail`（`module_tail` 走査）と `_header_cpp_type_from_east`（union/tuple 走査）の index `while` を `for` ベースへ置換した。`_header_allows_none_default` も同様に `for` 化を試行したが selfhost C++ で `list[str]` 走査が `object` 推論される型回帰が出たため当該箇所は `while` 維持へ戻し、`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.17.0 -> 0.18.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::emit_function`（`arg_names` 走査）と `_merge_args_with_kw_by_name`（`args`/`arg_names` 走査）の index `while` を `for` / `enumerate` ベースへ置換した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.18.0 -> 0.19.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_class_method_sig` と `_class_method_name_sig` の `candidates` 走査を `while` から `for i in range(len(candidates))` へ置換した。`for c in candidates` ではなく index ベースを維持し、selfhost の要素型推論回帰を避ける方針を採った。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.19.0 -> 0.20.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_fallback_tuple_target_names_from_repr` の `parts`/`nm` 走査を index `while` から `for range` ベースへ置換した。`repr_txt` の文字走査を `for ch in repr_txt` にした試行では selfhost 変換で内部エラーが再現したため、当該箇所のみ `while` を維持して安定側へ寄せた。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.20.0 -> 0.21.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_first_import_detail_line`、`_extract_function_signatures_from_python_source`（閉じ括弧探索）、`_extract_function_arg_types_from_python_source` の index `while` を `for range` ベースへ置換した。`for element in ...` ではなく index 参照を維持し、selfhost の要素型推論回帰を避ける方針を継続した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.21.0 -> 0.22.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::dump_deps_text`（`names/modules/symbols` 走査）と `_collect_import_modules`（`body_obj/names_obj` 走査）の index `while` を `for range` ベースへ置換した。`for element in ...` ではなく index 参照を維持し、selfhost 要素型推論の不安定域を避ける方針を継続した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.22.0 -> 0.23.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_analyze_import_graph`（`graph_keys/keys/visited_order` 走査）、`_format_graph_list_section`（`items` 走査）、`_format_import_graph_report`（`edges` 走査）の index `while` を `for range` ベースへ置換した。`for element in ...` を避けて index ベースを維持し、selfhost の要素型推論回帰を回避する方針を継続した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.23.0 -> 0.24.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_validate_import_graph_or_raise` の `reserved` / `relative` / `missing` / `cycles` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.24.0 -> 0.25.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_module_export_table` と `_validate_from_import_symbols_or_raise` の `body` / `targets` / `names` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.25.0 -> 0.26.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::build_module_east_map` と `build_module_type_schema` の `files` / `body_obj` / `body` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.26.0 -> 0.27.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_write_multi_file_cpp` の `files`（2箇所）と `arg_order` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.27.0 -> 0.28.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::build_cpp_header_from_east` の `body_obj` / `body` / `arg_order` / `includes` / `class_lines` / `var_lines` / `fn_lines` 走査と、`_resolve_user_module_path` の `candidates` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.28.0 -> 0.29.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::dump_deps_text` の `body_obj` / `import_bindings` / `body` / `Import.names` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.29.0 -> 0.30.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_resolve_user_module_path_for_graph` の `candidates` 走査と `_analyze_import_graph` の `mods` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.30.0 -> 0.31.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::build_module_symbol_index` の `body_obj` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.31.0 -> 0.32.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_sort_str_list_in_place` の `items/out` 走査と `_header_render_default_expr`（Tuple 分岐）の `elements` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.32.0 -> 0.33.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_header_guard_from_path` の `src` 走査と `_header_allows_none_default` の `parts` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.33.0 -> 0.34.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._collect_import_cpp_includes` と `CppEmitter._seed_import_maps_from_meta` の `bindings/refs` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.34.0 -> 0.35.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._mark_mutated_param_from_target` と `CppEmitter._render_param_default_expr` の `Tuple elements` 走査を index `while` から `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.35.0 -> 0.36.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter.transpile`（`arg_order` 走査）と `CppEmitter.render_minmax`（`arg_nodes_safe` 走査）の index `while` を `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.36.0 -> 0.37.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._collect_assigned_name_types`（Tuple 要素走査）、`CppEmitter._emit_noop_stmt`（Import/ImportFrom の `raw_names` 走査）、`CppEmitter.emit_assign`（`fallback_names` 走査）の index `while` を `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.37.0 -> 0.38.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._render_repr_expr`（比較連鎖の `pair_parts` 組み立て）の index `while` を `for range` へ置換した（`for element in ...` は使わず index 参照を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.38.0 -> 0.39.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_extract_function_signatures_from_python_source` の `lines` 走査（外側）と複数行 `def` 連結（内側）を index `while` から `for range` へ置換し、行スキップ制御は `skip_until` で維持した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.39.0 -> 0.40.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::CppEmitter._fallback_tuple_target_names_from_repr` の `repr_txt` 文字走査を index `while` から `for range` へ置換した（文字取得は `repr_txt[i:i+1]` を維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.40.0 -> 0.41.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_graph_cycle_dfs` の `nodes` 走査（`disp_nodes` 構築）を index `while` から `for range` へ置換した（index 参照は維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.41.0 -> 0.42.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::build_module_symbol_index`（`import_bindings` 未使用時の fallback）で `import_modules_obj2` / `import_symbols_obj2` の一時変数を削減し、`import_modules` / `import_symbols` への条件式代入へ簡潔化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.42.0 -> 0.43.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::dump_deps_text`（Import/ImportFrom の module/symbol/alias 読取）で `*_obj` からの手動 `isinstance` 展開を `_dict_any_get_str(...)` 呼び出しへ置換し、一時変数を簡潔化した。先に三項演算子での簡略化を試したが selfhost C++ で `object` と文字列リテラルの型不一致回帰が出たため取り下げ、selfhost-safe 版へ差し替えた。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.43.0 -> 0.44.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_meta_import_bindings` / `_meta_qualified_symbol_refs` の `module_id/export_name/local_name/binding_kind/symbol` 抽出で、`*_obj` + 手動 `isinstance` 展開を `_dict_any_get_str(...)` へ統一し一時変数を簡潔化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.44.0 -> 0.45.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_collect_import_modules` と `_validate_from_import_symbols_or_raise` の module/name 抽出で `obj -> isinstance -> 代入` の展開を `_dict_any_get_str(...)` 呼び出しへ統一し、一時変数を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.45.0 -> 0.46.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::build_module_east_map` と `build_module_type_schema` で `module_id/name/return_type` 抽出を `_dict_any_get_str(...)` へ統一し、`obj -> isinstance -> 代入` の一時変数展開を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.46.0 -> 0.47.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_module_id_from_east_for_graph` と `_module_id_from_east` の `meta.module_id` 抽出を `_dict_any_get_str(...)` に統一し、`obj -> isinstance -> 代入` 展開を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.47.0 -> 0.48.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_write_multi_file_cpp` の import symbol 解析で `sym["module"]` / `sig["return_type"]` / `arg_types[an]` 読取を `_dict_any_get_str(...)` に統一し、`obj -> isinstance -> 代入` 展開を簡潔化した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.48.0 -> 0.49.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_analyze_import_graph` の `resolved["path"]` 抽出を `_dict_any_get_str(...)` に統一し、`obj -> isinstance -> 代入` 展開を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.49.0 -> 0.50.0`）を確認。
- 2026-02-22: `P3-PY-01` の継続として `src/py2cpp.py::_graph_cycle_dfs` の `stack` 走査（`nodes` 構築）を index `while` から `for range` へ置換した（外側の `nxts` 走査は回帰履歴のため維持）。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.50.0 -> 0.51.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py` に `_dict_any_get_dict(...)` を追加し、`_write_multi_file_cpp` の `meta/import_modules/import_symbols/functions/arg_types` 読取で `obj -> isinstance -> 代入` 展開を削減した。併せて `_graph_cycle_dfs` の外側 `nxts` 走査を `for range` 化する試行は selfhost C++ で `cycles/cycle_seen` の `const` 推論回帰が出たため取り下げた。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.51.0 -> 0.52.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_meta_import_bindings`、`_meta_qualified_symbol_refs`、`build_module_east_map` の `meta` 抽出で `obj -> isinstance -> 代入` 展開を `_dict_any_get_dict(...)` へ統一した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.52.0 -> 0.53.0`）を確認。
- 2026-02-22: `P3-PY-05` の継続として `src/py2cpp.py::_module_id_from_east_for_graph`、`_module_id_from_east`、`build_module_symbol_index` の `meta` 抽出を `_dict_any_get_dict(...)` へ統一し、`obj -> isinstance -> 代入` 展開を削減した。`python3 tools/check_py2cpp_transpile.py`（`checked=117 ok=117 fail=0 skipped=5`）、`python3 tools/check_selfhost_cpp_diff.py --mode allow-not-implemented`（`mismatches=3` 既知維持）、`python3 tools/build_selfhost.py`（成功）、`python3 tools/check_transpiler_version_gate.py`（`cpp 0.53.0 -> 0.54.0`）を確認。

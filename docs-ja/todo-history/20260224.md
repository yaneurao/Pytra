# TODO履歴（2026-02-24）

<a href="../../docs/todo-history/20260224.md">
  <img alt="Read in English" src="https://img.shields.io/badge/docs-English-2563EB?style=flat-square">
</a>

## 2026-02-24 移管: `P0: EAST1/EAST2/EAST3 三段構成導入（最優先）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST1/EAST2/EAST3 三段構成導入（最優先）

文脈: `docs-ja/plans/p0-east123-staged-ir.md`（`TG-P0-EAST123`）

1. [x] [ID: P0-EAST123-01] `spec-east123` の仕様契約を実装仕様へ確定する（`P0-EAST123-01-S1` から `P0-EAST123-01-S4` 完了でクローズ）。
2. [x] [ID: P0-EAST123-01-S1] `EAST1/EAST2/EAST3` のルートスキーマ（`east_stage`, `schema_version`, `meta.dispatch_mode`）を仕様間で統一する。
3. [x] [ID: P0-EAST123-01-S2] `dispatch mode` の適用点と後段再判断禁止を仕様へ明文化する。
4. [x] [ID: P0-EAST123-01-S3] `spec-east` / `spec-type_id` / `spec-boxing` / `spec-iterable` / `spec-dev` の相互参照と責務境界を揃える。
5. [x] [ID: P0-EAST123-01-S4] `spec-east123` を上位仕様、`spec-linker` を下位仕様として確定し、仕様参照順（`east123` -> `linker`）を index/plan へ明記する。
6. [x] [ID: P0-EAST123-02] `EAST2 -> EAST3` core lowering の実装土台を導入する（`P0-EAST123-02-S1` から `P0-EAST123-02-S3` 完了でクローズ）。
7. [x] [ID: P0-EAST123-02-S1] `For` / `ForRange` を `ForCore` + `iter_plan` へ lower する最小経路を実装する。
8. [x] [ID: P0-EAST123-02-S2] `Any/object` 境界命令（`Box`/`Unbox`/`ObjBool`/`ObjLen`/`ObjStr`/`ObjIter*`）の EAST3 lower を実装する。
9. [x] [ID: P0-EAST123-02-S3] `--object-dispatch-mode` を `EAST2 -> EAST3` の単一地点で反映する。
10. [x] [ID: P0-EAST123-03] backend 側の意味論再解釈を禁止し、hooks を構文差分専任へ縮退する（`P0-EAST123-03-S1` から `P0-EAST123-03-S2` 完了でクローズ）。
11. [x] [ID: P0-EAST123-03-S1] C++ hooks / `py2cpp.py` の意味論実装経路（dispatch/boxing/iterable/built-in）を棚卸しする。
12. [x] [ID: P0-EAST123-03-S2] 棚卸し結果に基づいて意味論経路を EAST3 命令写像へ置換し、重複ロジックを撤去する（`P0-EAST123-03-S2-S1` から `P0-EAST123-03-S2-S3` 完了でクローズ）。
13. [x] [ID: P0-EAST123-03-S2-S1] CppEmitter 側で EAST3 命令ノード（`ForCore`, `Box/Unbox`, `ObjBool/ObjLen/ObjStr/ObjIter*`）を受理し、既存 C++ runtime API へ写像する。
14. [x] [ID: P0-EAST123-03-S2-S2] `For` / `iter_mode` / Any 境界の backend 再判断を段階的に EAST3 命令入力へ置換し、再判断箇所を縮退する。
15. [x] [ID: P0-EAST123-03-S2-S3] `py2cpp.py` と `hooks/cpp` の `runtime_call` / built-in 分岐重複を撤去し、EAST3 命令写像 + 構文差分 hook のみに収束させる。
16. [x] [ID: P0-EAST123-04] `EAST3` 契約（schema/例外/回帰）をテストで固定する（`P0-EAST123-04-S1` から `P0-EAST123-04-S3` 完了でクローズ）。
17. [x] [ID: P0-EAST123-04-S1] schema テスト（必須フィールド、`iter_plan` 形状、`dispatch_mode` 一貫性）を追加する。
18. [x] [ID: P0-EAST123-04-S2] lowering 契約テスト（`EAST2 -> EAST3`）を追加する。
19. [x] [ID: P0-EAST123-04-S3] selfhost + クロスターゲット回帰導線へ組み込む。
20. [x] [ID: P0-EAST123-05] hooks 縮退を定量管理する（`P0-EAST123-05-S1` から `P0-EAST123-05-S2` 完了でクローズ）。
21. [x] [ID: P0-EAST123-05-S1] C++ hooks の意味論/構文差分を分類し、基線メトリクスを記録する。
22. [x] [ID: P0-EAST123-05-S2] 意味論 hook の新規流入を防ぐ CI ルール（lint/チェック）を追加する。
23. [x] [ID: P0-EAST123-06] 現行 `EAST2`（`EAST1 + EAST2` 相当）を段階分離する（`P0-EAST123-06-S1` から `P0-EAST123-06-S2` 完了でクローズ）。
24. [x] [ID: P0-EAST123-06-S1] parser 直後の `EAST1` 出力 API（normalize なし）を追加する。
25. [x] [ID: P0-EAST123-06-S2] `EAST1 -> EAST2` normalize pass を分離し、既存 `load_east(...)` 互換を維持する。
26. [x] [ID: P0-EAST123-07] `type_id` lower を「EAST3 命令化 -> backend 写像」へ統一する（`P0-EAST123-07-S1` から `P0-EAST123-07-S2` 完了でクローズ）。
27. [x] [ID: P0-EAST123-07-S1] `isinstance` / `issubclass` / subtype 判定を EAST3 命令へ lower する。
28. [x] [ID: P0-EAST123-07-S2] backend 側の `type_id` 直書き判定生成を撤去し、runtime API 写像へ統一する。
29. [x] [ID: P0-EAST123-08] 言語非依存意味論を IR-first（EAST3 命令化 -> backend 写像）へ拡張する（`P0-EAST123-08-S1` から `P0-EAST123-08-S3` 完了でクローズ）。
30. [x] [ID: P0-EAST123-08-S1] `type_id` 以外で IR 化優先対象（boxing/unboxing, iterable, truthy/len/str, built-in lower）の移行順を確定する。
31. [x] [ID: P0-EAST123-08-S2] 第1陣（boxing/unboxing, iterable, truthy/len/str）を EAST3 命令へ移行する。
32. [x] [ID: P0-EAST123-08-S3] 第2陣（主要 built-in lower）を EAST3 命令へ移行し、C++ hooks を構文差分専任へ縮退する。
33. [x] [ID: P0-EAST123-08-S3-S1] `list/set` 系 built-in lower（append/extend/pop/insert/remove/contains/comprehension 補助）を IR-first（EAST3 命令 or IR ノード）へ段階移行する。
34. [x] [ID: P0-EAST123-08-S3-S2] `dict` 系 built-in lower（現行 runtime_call 対象: get/pop/items/keys/values）を IR-first へ移行し、Any/default 境界を backend 直書き分岐から撤去する。
35. [x] [ID: P0-EAST123-08-S3-S3] `str` / special built-in lower（replace/find/split/join/format/open/path/time など）を IR-first へ移行し、runtime_call 直分岐を縮退する。
36. [x] [ID: P0-EAST123-08-S3-S4] `py2cpp.py` built-in 分岐の backend 再判断を整理し、EAST3 命令写像 + 構文差分 hook のみへ収束させる（selfhost 差分ゼロ目標）。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（完了分）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（完了分）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-04] `tools/check_selfhost_cpp_diff.py` で差分ゼロを維持しながら fallback を縮退する。
2. [x] [ID: P1-CED-05] fallback が十分に減った段階で、共通ディスパッチを `CodeEmitter` 本体へ戻す。
3. [x] [ID: P1-CED-AC-01] Python 実行パス: `hooks` 有効時に既存ケースのコード生成結果が不変。
4. [x] [ID: P1-CED-AC-02] selfhost 実行パス: `mismatches=0` を維持。
5. [x] [ID: P1-CED-AC-03] `py2cpp.py` の `render_expr` / `emit_stmt` 本体分岐が段階的に短くなる。
6. [x] [ID: P1-CED-A-01] 優先 A: `If` / `While` / `ForRange` / `For` の文スケルトン生成（開閉ブロック + scope push/pop）を `CodeEmitter` へ移す。
7. [x] [ID: P1-CED-A-02] 優先 A: `Assign` / `AnnAssign` / `AugAssign` の「宣言判定 + 代入先レンダ」共通骨格を `CodeEmitter` へ移す。
8. [x] [ID: P1-CED-A-03] 優先 A: `Compare` / `BoolOp` / `IfExp` の式組み立てを `CodeEmitter` へ移す。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（完了分）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（完了分）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-01] `EAST1/EAST2/EAST3` の責務境界とファイル対応表（どの実装がどの段を担うか）を `docs-ja/spec/spec-east123-migration.md` と `docs-ja/plans/plan-east123-migration.md` で同期固定する。
2. [x] [ID: P0-EASTMIG-01-S1] `docs-ja/spec/spec-east123-migration.md` に現行責務対応表（`EAST1/2/3` と実装ファイル対応）を固定する。
3. [x] [ID: P0-EASTMIG-01-S2] `docs-ja/plans/plan-east123-migration.md` のサブタスク順と `todo` の実行順を同期する。
4. [x] [ID: P0-EASTMIG-01-S3] `docs-ja/spec/spec-east123.md` / `docs-ja/spec/index.md` から移行仕様への導線を整備し、参照先を固定する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（継続完了分）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（継続完了分）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-02] `transpile_cli.py` に集中している段階 API（`load_east1_document`, `normalize_east1_to_east2_document`, `load_east3_document`）を `src/pytra/compiler/east_parts/east1.py` / `east2.py` / `east3.py` へ分離し、`transpile_cli.py` は互換ラッパ責務へ縮退する。
2. [x] [ID: P0-EASTMIG-02-S1] `src/pytra/compiler/east_parts/east1.py` を追加し、`load_east1_document` と EAST1 ルート正規化 helper を移設する。
3. [x] [ID: P0-EASTMIG-02-S2] `src/pytra/compiler/east_parts/east2.py` を追加し、`normalize_east1_to_east2_document` と EAST2 契約 helper を移設する。
4. [x] [ID: P0-EASTMIG-02-S3] `src/pytra/compiler/east_parts/east3.py` を追加し、`load_east3_document` と `lower_east2_to_east3` 公開委譲を集約する。
5. [x] [ID: P0-EASTMIG-02-S4] `src/pytra/compiler/transpile_cli.py` を互換ラッパ中心へ縮退し、既存呼び出し互換をテストで固定する。
6. [x] [ID: P0-EASTMIG-03-S1] `py2cpp.py` の `--east-stage` 分岐を棚卸しし、`EAST2` 依存箇所（For/ForRange/iter_plan）を `EAST3` 命令入力へ置換する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（Any/object 境界）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（Any/object 境界）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-03-S2] `Any/object` 境界（Box/Unbox/Obj*）で backend 再判断している経路を `EAST3` 命令写像へ統一する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（type_id/builtin lower）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（type_id/builtin lower）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-03-S3] `type_id` / built-in lower の `EAST2` 依存分岐を削減し、`EAST3` 前提経路を主経路化する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（主経路化回帰基線）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（主経路化回帰基線）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-03-S4] `tools/check_py2cpp_transpile.py` と `tools/check_selfhost_cpp_diff.py --mode allow-not-implemented` で主経路化後の回帰基線を固定する。
2. [x] [ID: P0-EASTMIG-03] `py2cpp.py` の標準経路を `EAST3` 前提へ寄せ、`EAST2` 再判断ロジック（For/Any/object/type_id/builtin）を段階縮退する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（hooks 棚卸し）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（hooks 棚卸し）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-04-S1] `src/hooks/cpp/` の hook を「意味論」「構文差分」に分類し、一覧を `docs-ja/plans/plan-east123-migration.md` に記録する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（hooks 意味論撤去）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（hooks 意味論撤去）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-04-S2] 意味論 hook を `EAST3` 命令写像または共通層へ移し、C++ hooks 側から撤去する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（hooks 流入防止）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（hooks 流入防止）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-04-S3] 意味論 hook の新規流入を防ぐチェック（lint またはテスト）を追加する。
2. [x] [ID: P0-EASTMIG-04] C++ hooks の意味論実装を棚卸しし、`EAST3` 前提の構文差分専任へ縮退する（意味論 hook の新規追加を禁止）。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（EAST3 主経路テスト拡充）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（EAST3 主経路テスト拡充）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-05-S1] `test/unit/test_east3_lowering.py` / `test/unit/test_east3_cpp_bridge.py` を `EAST3` 主経路前提で拡充する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（標準回帰導線の文書化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（標準回帰導線の文書化）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-05-S2] `tools/check_py2{cpp,js,ts}_transpile.py` と selfhost 差分検証を `EAST3` 主経路の標準導線として文書化する。

## 2026-02-24 移管: `P0: EAST123 責務境界の可視化移行（EAST2 互換モード縮退）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P0: EAST123 責務境界の可視化移行（EAST2 互換モード縮退）

文脈: `docs-ja/plans/plan-east123-migration.md`（`TG-P0-EAST123-MIGRATION`）

1. [x] [ID: P0-EASTMIG-05-S3] `--east-stage 2` を移行互換モードとして位置づけ、縮退手順（警告/段階撤去）を `docs-ja/spec/spec-east123-migration.md` と `docs-ja/plans/plan-east123-migration.md` に明記する。
2. [x] [ID: P0-EASTMIG-05] `--east-stage 3` 主経路の回帰導線（unit/transpile/selfhost）を標準化し、`EAST2` 入力を移行互換モードとして段階的に格下げする。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（import 束縛表）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（import 束縛表）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-A-04] 優先 A: import 束縛テーブル読み込み（`meta.import_bindings` 反映）を `CodeEmitter` へ移す。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（型写像共通化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（型写像共通化）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-B-01] 優先 B: 型名正規化 + 言語型への最終写像（`normalize_type_name` 後段）を共通化する。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（Call 前処理共通利用）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（Call 前処理共通利用）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-B-02] 優先 B: `Call` 前処理（`_prepare_call_parts` 結果の共通利用）を共通化する。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（Tuple 代入 tmp lower 共通化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（Tuple 代入 tmp lower 共通化）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-B-03] 優先 B: `Tuple` 代入の一時変数 lower を共通化する。

## 2026-02-24 移管: `P1: CodeEmitter 共通ディスパッチ再設計（文字列/配列最適化共通化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: CodeEmitter 共通ディスパッチ再設計（文字列/配列最適化共通化）

文脈: `docs-ja/plans/p1-codeemitter-dispatch-redesign.md`（`TG-P1-CED`）

1. [x] [ID: P1-CED-C-02] 優先 C: 文字列/配列の細かい最適化（演算子簡約・括弧削減）を共通化する。

## 2026-02-24 移管: `P1: py2cpp 縮退（分類インベントリ確定）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（分類インベントリ確定）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-01-S1] `py2cpp.py` 内ロジックを「言語非依存」「C++固有」に分類し、移管順を確定する。

## 2026-02-24 移管: `P1: py2cpp 縮退（言語非依存 helper 移管）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（言語非依存 helper 移管）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-01-S2] tuple ターゲット復元（`fallback_tuple_target_names_from_repr`）と for 変数束縛収集（`target_bound_names`）を `CodeEmitter` 側へ移管し、`py2cpp.py` から同名 helper を削除する。

## 2026-02-24 移管: `P1: py2cpp 縮退（for runtime 分岐重複の削減）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（for runtime 分岐重複の削減）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-01-S3-S1] `_emit_for_each_runtime` 内で重複していた Name ターゲット束縛分岐を `_emit_for_each_runtime_target_bind` へ抽出し、`omit_braces` 有無で二重実装されていた分岐を単一路へ縮退する。

## 2026-02-24 移管: `P1: py2cpp 縮退（for 系 scope/omit 骨格の共通化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（for 系 scope/omit 骨格の共通化）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-01-S3-S2] `emit_for_each` / `_emit_for_each_runtime` に重複していた `scope push/pop + omit_braces` 骨格を `_emit_for_body_open` / `_emit_for_body_stmts` / `_emit_for_body_close` へ共通化し、for 系分岐重複を削減する。

## 2026-02-24 移管: `P1: py2cpp 縮退（for ヘッダ/target scope 重複削減と S3 完了）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（for ヘッダ/target scope 重複削減と S3 完了）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-01-S3-S3] `emit_for_range` を for 共通骨格 helper（`_emit_for_body_open` / `_emit_for_body_stmts` / `_emit_for_body_close`）へ寄せ、`emit_for_each` 系と重複していたヘッダ生成・target scope 構築分岐を削減する。
2. [x] [ID: P1-CPP-REDUCE-01-S3] selfhost 差分ゼロを維持したまま `py2cpp.py` の重複分岐を削減する（`S3-S1` から `S3-S3` 完了）。
3. [x] [ID: P1-CPP-REDUCE-01] `src/py2cpp.py` に残る未移行ロジックの段階移管（`S1`〜`S3`）を完了する。

## 2026-02-24 移管: `P1: py2cpp 縮退（運用ルール文書化）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（運用ルール文書化）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-02-S1] 「汎用 helper 禁止 / 共通層先行抽出」の運用ルールを `docs-ja/spec/spec-dev.md` に明文化する。

## 2026-02-24 移管: `P1: py2cpp 縮退（helper 追加検出チェック導入）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（helper 追加検出チェック導入）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-02-S2] `tools/check_py2cpp_helper_guard.py` と `tools/py2cpp_cpp_helper_allowlist.txt` を追加し、`CppEmitter` private helper の新規追加を CI で検出できるようにする（`tools/run_local_ci.py` へ組み込み）。

## 2026-02-24 移管: `P1: py2cpp 縮退（hotfix 例外運用定義と P1-CPP-REDUCE-02 完了）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: py2cpp 縮退（hotfix 例外運用定義と P1-CPP-REDUCE-02 完了）

文脈: `docs-ja/plans/p1-py2cpp-reduction.md`（`TG-P1-CPP-REDUCE`）

1. [x] [ID: P1-CPP-REDUCE-02-S3] 緊急 hotfix 時の暫定運用（`TEMP-CXX-HOTFIX` コメント + ID 必須）と後追い抽出期限（7日以内または次回 PATCH リリースまで）を `docs-ja/spec/spec-dev.md` に定義する。
2. [x] [ID: P1-CPP-REDUCE-02] 「汎用 helper 禁止 / 共通層先行抽出」運用（`S1`〜`S3`）を完了する。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（import graph 解析 API 移管）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（import graph 解析 API 移管）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-01] `src/py2cpp.py::_analyze_import_graph` の本体を `src/pytra/compiler/transpile_cli.py::analyze_import_graph` へ抽出し、`py2cpp.py` は共通 API 呼び出しへ縮退する。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（module EAST map API 移管）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（module EAST map API 移管）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-02] `build_module_east_map` の本体を `src/pytra/compiler/transpile_cli.py` の共通 API 化（`build_module_east_map`）し、`py2cpp.py` 側は委譲ラッパーへ縮退する。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（symbol index/type schema API 反映済み整理）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（symbol index/type schema API 反映済み整理）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-03] module symbol index / type schema 構築（`build_module_symbol_index`, `build_module_type_schema`）の共通 API 化は実装済みのため、未完了 TODO から履歴へ整理移管する。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（deps dump API 移管）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（deps dump API 移管）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-04] `dump_deps_graph_text` を `src/pytra/compiler/transpile_cli.py` の共通 API として追加し、`py2cpp.py` 側は委譲ラッパーへ縮退する。`dump_deps_text`/`format_import_graph_report`/import graph 解析 API と同一層へ統合し、CLI 層は表示責務へ寄せる。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（C++責務境界の固定）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（C++責務境界の固定）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-05] `py2cpp.py` のトップレベル責務を「C++固有処理 + 互換ラッパ」に限定し、`tools/check_py2cpp_boundary.py` で境界を検証可能にする。CI 導線（`tools/run_local_ci.py`）へ同チェックを組み込み、将来の汎用処理逆流を防止する。

## 2026-02-24 移管: `P1: コンパイラ共通層への抽出（汎用 helper 偏在解消完了）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: コンパイラ共通層への抽出（汎用 helper 偏在解消完了）

文脈: `docs-ja/plans/p1-compiler-shared-extraction.md`（`TG-P1-COMP-SHARED`）

1. [x] [ID: P1-COMP-09] `py2cpp.py` に残る汎用 helper（例: 文字列リスト整列、module 解析補助）を `src/pytra/compiler/` へ移管し、非 C++ 各 `py2*` から同一実装を再利用できる状態にする。
2. [x] [ID: P1-COMP-10] 「全言語 selfhost を阻害しない共通層優先」の運用ルールを整備し、`py2cpp.py` へ汎用処理が再流入しない回帰チェック（lint/静的検査または CI ルール）を追加する。
3. [x] [ID: P1-COMP-11] `src/pytra/compiler/transpile_cli.py` の汎用 helper 群を機能グループごとに `class + @staticmethod` へ整理し、`py2cpp.py` 側 import を class 単位へ縮退する。移行時はトップレベル互換ラッパーを暫定維持し、`tools/prepare_selfhost_source.py` / `test/unit/test_prepare_selfhost_source.py` の抽出ロジックも同時更新して selfhost 回帰を防ぐ。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust棚卸し対応表）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust棚卸し対応表）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-01-S1] `src/rs_module/` の機能を責務別に棚卸しし、`src/runtime/rs/pytra/{built_in,std,utils,compiler}` への対応表を作る。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust新配置への段階移動）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust新配置への段階移動）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-01-S2] Rust runtime ファイルを新配置へ段階移動し、互換 include/import レイヤを暫定維持する。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust配置統一完了）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust配置統一完了）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-01-S3] selfhost/transpile 回帰を通したうえで `src/rs_module/` 依存を縮退する。
2. [x] [ID: P1-RUNTIME-01] Rust ランタイムを `src/rs_module/` から `src/runtime/rs/pytra/` へ段階移行し、`src/runtime/cpp/pytra/` と同等の責務分割（`built_in/`, `std/`, `utils/`, `compiler/`）に揃える。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust path解決箇所の棚卸し）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust path解決箇所の棚卸し）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-02-S1] Rust emitter/hooks の path 解決箇所を特定し、新旧パス併用期間の互換仕様を定義する。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust参照先切替完了）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust参照先切替完了）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-02-S2] 参照先を新パスへ切り替え、旧パス fallback を段階撤去する。
2. [x] [ID: P1-RUNTIME-02] `py2rs.py` / Rust hooks のランタイム解決パスを `src/runtime/rs/pytra/` 基準へ更新する（`P1-RUNTIME-02-S1` から `P1-RUNTIME-02-S2` 完了でクローズ）。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（rs_module参照元棚卸し）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（rs_module参照元棚卸し）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-03-S1] `src/rs_module/` 参照元を全件列挙し、廃止可否を判定する。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（rs_module廃止）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（rs_module廃止）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-03-S2] 参照を `src/runtime/rs/pytra/` 側へ置換し、`src/rs_module/` を削除する。
2. [x] [ID: P1-RUNTIME-03] `src/rs_module/` の既存参照を洗い出し、互換レイヤを経由して最終的に廃止する（`P1-RUNTIME-03-S1` から `P1-RUNTIME-03-S2` 完了でクローズ）。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust以外 path 棚卸し）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust以外 path 棚卸し）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-05-S1] 言語ごとの現行 runtime 解決パスを棚卸しし、差分一覧を作成する。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（Rust以外 path 参照更新）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（Rust以外 path 参照更新）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-05-S2] 各 `py2<lang>.py` / hooks の参照先を `src/runtime/<lang>/pytra/` 基準へ順次更新する。

## 2026-02-24 移管: `P1: 多言語ランタイム配置統一（旧パス段階撤去）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語ランタイム配置統一（旧パス段階撤去）

文脈: `docs-ja/plans/p1-runtime-layout-unification.md`（`TG-P1-RUNTIME-LAYOUT`）

1. [x] [ID: P1-RUNTIME-05-S3] 多言語 smoke で回帰確認し、旧パス互換レイヤを段階撤去する。
2. [x] [ID: P1-RUNTIME-05] 各言語トランスパイラ（`py2cs.py`, `py2js.py`, `py2ts.py`, `py2go.py`, `py2java.py`, `py2kotlin.py`, `py2swift.py`）と hooks のランタイム解決パスを `src/runtime/<lang>/pytra/` 基準へ統一する（`P1-RUNTIME-05-S1` から `P1-RUNTIME-05-S3` 完了でクローズ）。

## 2026-02-24 移管: `P1: 多言語出力品質（計測基線確定）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語出力品質（計測基線確定）

文脈: `docs-ja/plans/p1-multilang-output-quality.md`（`TG-P1-MULTILANG-QUALITY`）

1. [x] [ID: P1-MQ-01] `sample/{rs,cs,js,ts,go,java,swift,kotlin}` の生成品質を計測し、`sample/cpp` 比での差分（過剰 `mut` / 括弧 / cast / clone / 未使用 import）を定量化する。

## 2026-02-24 移管: `P1: 多言語出力品質（Rust mut 縮退）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語出力品質（Rust mut 縮退）

文脈: `docs-ja/plans/p1-multilang-output-quality.md`（`TG-P1-MULTILANG-QUALITY`）

1. [x] [ID: P1-MQ-02-S1] Rust emitter の `mut` 付与を「実際に書き換えがある識別子のみ」へ縮退し、`sample/rs` の可読性指標（`mut`/括弧/cast/clone）を改善する。

## 2026-02-24 移管: `P1: 多言語出力品質（JS/TS 括弧・import 縮退）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語出力品質（JS/TS 括弧・import 縮退）

文脈: `docs-ja/plans/p1-multilang-output-quality.md`（`TG-P1-MULTILANG-QUALITY`）

1. [x] [ID: P1-MQ-02-S2] JS/TS の過剰括弧と import 整理を中心に、`sample/js` / `sample/ts` の可読性を改善する。

## 2026-02-24 移管: `P1: 多言語出力品質（C# cast/import/paren 縮退）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語出力品質（C# cast/import/paren 縮退）

文脈: `docs-ja/plans/p1-multilang-output-quality.md`（`TG-P1-MULTILANG-QUALITY`）

1. [x] [ID: P1-MQ-02-S3-S1] C# emitter の cast/import/括弧冗長を段階削減し、`sample/cs` の品質差分を縮小する。

## 2026-02-24 移管: `P1: 多言語出力品質（Go/Java preview 冗長縮退）`

以下を `docs-ja/todo.md` から `todo-history` へ移管。

## P1: 多言語出力品質（Go/Java preview 冗長縮退）

文脈: `docs-ja/plans/p1-multilang-output-quality.md`（`TG-P1-MULTILANG-QUALITY`）

1. [x] [ID: P1-MQ-02-S3-S2] Go/Java の変換器で runtime/import/cast 冗長を削減し、`sample/go` / `sample/java` の品質差分を縮小する。

# TODO履歴（2026-03-02）

<a href="../../../en/todo/archive/20260302.md">
  <img alt="Read in English" src="https://img.shields.io/badge/docs-English-2563EB?style=flat-square">
</a>

## 2026-03-02 移管: `P0: Scala3 parity 全通過化（sample + fixture）`

以下を `docs/ja/todo/index.md` から `todo/archive` へ移管。

文脈: [docs/ja/plans/p0-scala3-full-parity-rollout.md](../plans/p0-scala3-full-parity-rollout.md)

1. [x] [ID: P0-SCALA3-PARITY-ALL-01] Scala3 backend で parity（stdout + artifact）を sample/fixture ともに全通過させる。
2. [x] [ID: P0-SCALA3-PARITY-ALL-01-S1-01] sample 全件 + fixture 正例群の baseline を取得し、失敗カテゴリを固定する。
3. [x] [ID: P0-SCALA3-PARITY-ALL-01-S1-02] Scala fixture parity の対象マニフェストを定義し、負例（P2）との境界を固定する。
4. [x] [ID: P0-SCALA3-PARITY-ALL-01-S2-01] `save_gif` / `write_rgb_png` の `__pytra_noop` 経路を撤去して runtime 実装へ接続する。
5. [x] [ID: P0-SCALA3-PARITY-ALL-01-S2-02] `// TODO: unsupported ...` 出力経路を縮小し、必要ノードの lowering を実装する（未対応は fail-closed）。
6. [x] [ID: P0-SCALA3-PARITY-ALL-01-S2-03] sample/18 を含む高難度ケースの builtin/container 不足を補完し、`run_failed` を解消する。
7. [x] [ID: P0-SCALA3-PARITY-ALL-01-S2-04] 継承先で上書きされるメソッドに `override def` を出力し、Scala3 の継承契約へ一致させる。
8. [x] [ID: P0-SCALA3-PARITY-ALL-01-S3-01] `runtime_parity_check` の Scala artifact optional を撤去し、関連 unit テストを更新する。
9. [x] [ID: P0-SCALA3-PARITY-ALL-01-S3-02] Scala parity の再実行導線（専用チェック）を追加し、CI/ローカル手順を固定する。
10. [x] [ID: P0-SCALA3-PARITY-ALL-01-S3-03] parity 実行結果を確認し、`how-to-use` と `spec-tools` の Scala 手順を同期する。

## 2026-03-02 移管: `P1: sample/go/01 品質改善（C++品質との差分縮小）`

以下を `docs/ja/todo/index.md` から `todo/archive` へ移管。

文脈: [docs/ja/plans/p1-go-sample01-quality-uplift.md](../plans/p1-go-sample01-quality-uplift.md)

1. [x] [ID: P1-GO-SAMPLE01-QUALITY-01] Go backend の `sample/01` 出力品質を改善し、C++ 出力との差を縮小する。
2. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S1-01] `sample/go/01` の品質差分（冗長 cast / loop / no-op / any退化）を棚卸しし、改善優先順を固定する。
3. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S2-01] Go emitter の数値演算出力で同型変換連鎖を削減し、typed 経路を優先する。
4. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S2-02] `range(stop)` / `range(start, stop, 1)` 系を canonical `for` へ lower する fastpath を追加する。
5. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S2-03] `write_rgb_png` 経路を no-op から native runtime 呼び出しへ接続し、未解決時は fail-closed にする。
6. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S2-04] `sample/01` の `pixels` ホットパスで `[]any` 退化を抑制する typed container fastpath を追加する。
7. [x] [ID: P1-GO-SAMPLE01-QUALITY-01-S3-01] 回帰テスト（コード断片 + parity）を追加し、`sample/go/01` 再生成差分を固定する。

## 2026-03-02 移管: 完了済みセクション（4件）

以下を `docs/ja/todo/index.md` から `todo/archive` へ移管。

### P0: sample/scala/01 品質改善（C++品質との差分縮小）

文脈: [docs/ja/plans/p0-scala-sample01-quality-uplift.md](../plans/p0-scala-sample01-quality-uplift.md)

1. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01] `sample/scala/01` の生成品質を改善し、C++ 出力との差を縮小する。
2. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S1-01] `sample/scala/01` と `sample/cpp/01` を比較し、冗長項目（cast/loop/runtime埋込/typed退化）を断片で固定する。
3. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S1-02] Scala emitter 改善の優先順（可読性インパクト × 実装難易度）を確定する。
4. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S2-01] 数値演算出力の同型 cast 連鎖を削減し、typed 経路を優先する。
5. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S2-02] `range(stop)` / `range(start, stop, 1)` を canonical loop へ lower する fastpath を追加する。
6. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S2-03] `pixels` append ホットパスで `mutable.ArrayBuffer[Any]` typed 経路を優先し、再ラップを削減する。
7. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S2-04] runtime/helper 埋め込みの縮退方針（外出しまたは最小埋込）を実装し、`sample/01` の見通しを改善する。
8. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S3-01] 回帰テスト（コード断片）を追加し、`sample/scala/01` 差分を固定する。
9. [x] [ID: P0-SCALA-SAMPLE01-QUALITY-01-S3-02] `sample/scala` 再生成 + smoke/parity を実行して非退行を確認する。
- 進捗メモ: [ID: P0-SCALA-SAMPLE01-QUALITY-01] cast/loop/append fastpath + runtime helper 最小埋め込みを実装し、`sample/scala/01` を 703 行→310 行へ縮退、smoke（17件）/sample parity（18件）を通過。

### P0: `regenerate_samples.py` への Scala 追加（最優先）

文脈: [docs/ja/plans/p0-regenerate-samples-scala-support.md](../plans/p0-regenerate-samples-scala-support.md)

1. [x] [ID: P0-REGEN-SCALA-SUPPORT-01] `tools/regenerate_samples.py` で `--langs scala` を正式サポートし、`sample/scala` 再生成導線を統合する。
2. [x] [ID: P0-REGEN-SCALA-SUPPORT-01-S1-01] `LANG_CONFIGS` / `LANG_VERSION_DEPENDENCIES` / `--langs` default を棚卸しし、Scala 追加方針を確定する。
3. [x] [ID: P0-REGEN-SCALA-SUPPORT-01-S2-01] `tools/regenerate_samples.py` に `scala` 設定を追加し、CLI から `--langs scala` を受理できるようにする。
4. [x] [ID: P0-REGEN-SCALA-SUPPORT-01-S2-02] version token 判定に `scala` を接続し、cache ベースの skip/regen 判定を有効化する。
5. [x] [ID: P0-REGEN-SCALA-SUPPORT-01-S3-01] `sample/scala` を再生成し、生成差分が期待どおり更新されることを確認する。
6. [x] [ID: P0-REGEN-SCALA-SUPPORT-01-S3-02] smoke/check を実行し、非退行を確認する。
- 進捗メモ: [ID: P0-REGEN-SCALA-SUPPORT-01] `--langs scala` を正式対応し、`--force` 再生成（18件）・dry-run skip（18件）・`cpp/go` dry-run 非退行・Scala smoke（17件）を確認。

### P1: sample/kotlin/01 品質改善（C++品質との差分縮小）

文脈: [docs/ja/plans/p1-kotlin-sample01-quality-uplift.md](../plans/p1-kotlin-sample01-quality-uplift.md)

1. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01] Kotlin backend の `sample/01` 出力品質を改善し、C++ 出力との差を縮小する。
2. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S1-01] `sample/kotlin/01` の品質差分（冗長 cast / loop / no-op / any退化）を棚卸しし、改善優先順を固定する。
3. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S2-01] Kotlin emitter の数値演算出力で同型変換連鎖を削減し、typed 経路を優先する。
4. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S2-02] 単純 `range` ループを canonical loop へ lower する fastpath を追加する。
5. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S2-03] `write_rgb_png` 経路を no-op から native runtime 呼び出しへ接続し、未解決時は fail-closed にする。
6. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S2-04] `sample/01` の `pixels` 経路で typed container fastpath を追加し、`MutableList<Any?>` 退化を抑制する。
7. [x] [ID: P1-KOTLIN-SAMPLE01-QUALITY-01-S3-01] 回帰テスト（コード断片 + parity）を追加し、`sample/kotlin/01` 再生成差分を固定する。
- 進捗メモ: [ID: P1-KOTLIN-SAMPLE01-QUALITY-01] `write_rgb_png` no-op撤去（runtime実装追加）・cast/loop/append fastpath を実装し、`sample/kotlin/01` の `__pytra_float` 78→10 / `__pytra_int` 41→17 を確認。unit(14)/transpile(131)/sample01 parity(kotlin) を通過。

### P1: sample/swift/01 品質改善（C++品質との差分縮小）

文脈: [docs/ja/plans/p1-swift-sample01-quality-uplift.md](../plans/p1-swift-sample01-quality-uplift.md)

1. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01] Swift backend の `sample/01` 出力品質を改善し、C++ 出力との差を縮小する。
2. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S1-01] `sample/swift/01` の品質差分（冗長 cast / loop / no-op / any退化）を棚卸しし、改善優先順を固定する。
3. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S2-01] Swift emitter の数値演算出力で同型変換連鎖を削減し、typed 経路を優先する。
4. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S2-02] 単純 `range` ループを canonical loop へ lower する fastpath を追加する。
5. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S2-03] `write_rgb_png` 経路を no-op から native runtime 呼び出しへ接続し、未解決時は fail-closed にする。
6. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S2-04] `sample/01` の `pixels` 経路で typed container fastpath を追加し、`[Any]` 退化を抑制する。
7. [x] [ID: P1-SWIFT-SAMPLE01-QUALITY-01-S3-01] 回帰テスト（コード断片 + parity）を追加し、`sample/swift/01` 再生成差分を固定する。
- 進捗メモ: [ID: P1-SWIFT-SAMPLE01-QUALITY-01] `write_rgb_png` no-op撤去（Swift runtime に PNG writer追加）・cast/loop/append fastpath を実装し、`sample/swift/01` の `__pytra_float` 78→10 / `__pytra_int` 39→17 を確認。unit(12)/transpile(131)/sample01 parity(swift, toolchain_missingでskip扱いPASS) を通過。

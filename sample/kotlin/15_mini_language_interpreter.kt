// このファイルは自動生成です（Python -> Kotlin node-backed mode）。

// Kotlin 実行向け Node.js ランタイム補助。

import java.io.File
import java.nio.file.Files
import java.nio.file.Path
import java.util.Base64
import java.util.UUID

/**
 * Base64 で埋め込まれた JavaScript ソースコードを一時ファイルへ展開し、node で実行する。
 */
object PyRuntime {
    /**
     * @param sourceBase64 JavaScript ソースコードの Base64 文字列。
     * @param args JavaScript 側へ渡す引数配列。
     * @return node プロセスの終了コード。失敗時は 1 を返す。
     */
    @JvmStatic
    fun runEmbeddedNode(sourceBase64: String, args: Array<String>): Int {
        val sourceBytes: ByteArray = try {
            Base64.getDecoder().decode(sourceBase64)
        } catch (ex: IllegalArgumentException) {
            System.err.println("error: failed to decode embedded JavaScript source")
            return 1
        }

        val tempFile: Path = try {
            val name = "pytra_embedded_${UUID.randomUUID()}.js"
            val p = File(System.getProperty("java.io.tmpdir"), name).toPath()
            Files.write(p, sourceBytes)
            p
        } catch (ex: Exception) {
            System.err.println("error: failed to write temporary JavaScript file: ${ex.message}")
            return 1
        }

        val command = mutableListOf("node", tempFile.toString())
        command.addAll(args)
        val process: Process = try {
            ProcessBuilder(command)
                .inheritIO()
                .start()
        } catch (ex: Exception) {
            System.err.println("error: failed to launch node: ${ex.message}")
            try {
                Files.deleteIfExists(tempFile)
            } catch (_: Exception) {
            }
            return 1
        }

        val code = process.waitFor()
        try {
            Files.deleteIfExists(tempFile)
        } catch (_: Exception) {
        }
        return code
    }
}

class pytra_15_mini_language_interpreter {
    companion object {
        // 埋め込み JavaScript ソース（Base64）。
        private const val PYTRA_EMBEDDED_JS_BASE64: String = "Ly8gZ2VuZXJhdGVkIGludGVybmFsIEphdmFTY3JpcHQKCmNvbnN0IF9fcHl0cmFfcm9vdCA9IHByb2Nlc3MuY3dkKCk7CmNvbnN0IHB5X3J1bnRpbWUgPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS9weV9ydW50aW1lLmpzJyk7CmNvbnN0IHB5X21hdGggPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS9tYXRoLmpzJyk7CmNvbnN0IHB5X3RpbWUgPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS90aW1lLmpzJyk7CmNvbnN0IHsgcHlQcmludCwgcHlMZW4sIHB5Qm9vbCwgcHlSYW5nZSwgcHlGbG9vckRpdiwgcHlNb2QsIHB5SW4sIHB5U2xpY2UsIHB5T3JkLCBweUNociwgcHlCeXRlYXJyYXksIHB5Qnl0ZXMsIHB5SXNEaWdpdCwgcHlJc0FscGhhIH0gPSBweV9ydW50aW1lOwpjb25zdCB7IHBlcmZDb3VudGVyIH0gPSBweV90aW1lOwpjb25zdCBwZXJmX2NvdW50ZXIgPSBwZXJmQ291bnRlcjsKCmNsYXNzIFRva2VuIHsKICAgIGNvbnN0cnVjdG9yKGtpbmQsIHRleHQsIHBvcykgewogICAgICAgIHRoaXMua2luZCA9IGtpbmQ7CiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgICAgICB0aGlzLnBvcyA9IHBvczsKICAgIH0KfQpjbGFzcyBFeHByTm9kZSB7CiAgICBjb25zdHJ1Y3RvcihraW5kLCB2YWx1ZSwgbmFtZSwgb3AsIGxlZnQsIHJpZ2h0KSB7CiAgICAgICAgdGhpcy5raW5kID0ga2luZDsKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLm9wID0gb3A7CiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDsKICAgICAgICB0aGlzLnJpZ2h0ID0gcmlnaHQ7CiAgICB9Cn0KY2xhc3MgU3RtdE5vZGUgewogICAgY29uc3RydWN0b3Ioa2luZCwgbmFtZSwgZXhwcl9pbmRleCkgewogICAgICAgIHRoaXMua2luZCA9IGtpbmQ7CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLmV4cHJfaW5kZXggPSBleHByX2luZGV4OwogICAgfQp9CmZ1bmN0aW9uIHRva2VuaXplKGxpbmVzKSB7CiAgICBsZXQgdG9rZW5zID0gW107CiAgICBsZXQgbGluZV9pbmRleCA9IDA7CiAgICB3aGlsZSAocHlCb29sKCgobGluZV9pbmRleCkgPCAocHlMZW4obGluZXMpKSkpKSB7CiAgICAgICAgbGV0IHNvdXJjZSA9IGxpbmVzW2xpbmVfaW5kZXhdOwogICAgICAgIGxldCBpID0gMDsKICAgICAgICBsZXQgbiA9IHB5TGVuKHNvdXJjZSk7CiAgICAgICAgd2hpbGUgKHB5Qm9vbCgoKGkpIDwgKG4pKSkpIHsKICAgICAgICAgICAgbGV0IGNoID0gcHlTbGljZShzb3VyY2UsIGksICgoaSkgKyAoMSkpKTsKICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCcgJykpKSkgewogICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCcrJykpKSkgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdQTFVTJywgY2gsIGkpKTsKICAgICAgICAgICAgICAgIGkgPSBpICsgMTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChweUJvb2woKChjaCkgPT09ICgnLScpKSkpIHsKICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKG5ldyBUb2tlbignTUlOVVMnLCBjaCwgaSkpOwogICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCcqJykpKSkgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdTVEFSJywgY2gsIGkpKTsKICAgICAgICAgICAgICAgIGkgPSBpICsgMTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChweUJvb2woKChjaCkgPT09ICgnLycpKSkpIHsKICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKG5ldyBUb2tlbignU0xBU0gnLCBjaCwgaSkpOwogICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCcoJykpKSkgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdMUEFSRU4nLCBjaCwgaSkpOwogICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCcpJykpKSkgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdSUEFSRU4nLCBjaCwgaSkpOwogICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGNoKSA9PT0gKCc9JykpKSkgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdFUVVBTCcsIGNoLCBpKSk7CiAgICAgICAgICAgICAgICBpID0gaSArIDE7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHlCb29sKHB5SXNEaWdpdChjaCkpKSB7CiAgICAgICAgICAgICAgICBsZXQgc3RhcnQgPSBpOwogICAgICAgICAgICAgICAgd2hpbGUgKHB5Qm9vbCgoKChpKSA8IChuKSkgJiYgcHlJc0RpZ2l0KHB5U2xpY2Uoc291cmNlLCBpLCAoKGkpICsgKDEpKSkpKSkpIHsKICAgICAgICAgICAgICAgICAgICBpID0gaSArIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IHB5U2xpY2Uoc291cmNlLCBzdGFydCwgaSk7CiAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChuZXcgVG9rZW4oJ05VTUJFUicsIHRleHQsIHN0YXJ0KSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHlCb29sKChweUlzQWxwaGEoY2gpIHx8ICgoY2gpID09PSAoJ18nKSkpKSkgewogICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gaTsKICAgICAgICAgICAgICAgIHdoaWxlIChweUJvb2woKCgoaSkgPCAobikpICYmICgocHlJc0FscGhhKHB5U2xpY2Uoc291cmNlLCBpLCAoKGkpICsgKDEpKSkpIHx8ICgocHlTbGljZShzb3VyY2UsIGksICgoaSkgKyAoMSkpKSkgPT09ICgnXycpKSkgfHwgcHlJc0RpZ2l0KHB5U2xpY2Uoc291cmNlLCBpLCAoKGkpICsgKDEpKSkpKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgaSA9IGkgKyAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IHRleHQgPSBweVNsaWNlKHNvdXJjZSwgc3RhcnQsIGkpOwogICAgICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKHRleHQpID09PSAoJ2xldCcpKSkpIHsKICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChuZXcgVG9rZW4oJ0xFVCcsIHRleHQsIHN0YXJ0KSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChweUJvb2woKCh0ZXh0KSA9PT0gKCdwcmludCcpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdQUklOVCcsIHRleHQsIHN0YXJ0KSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2gobmV3IFRva2VuKCdJREVOVCcsIHRleHQsIHN0YXJ0KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCgoKCgoKCgoKCgndG9rZW5pemUgZXJyb3IgYXQgbGluZT0nKSArIChTdHJpbmcobGluZV9pbmRleCkpKSkgKyAoJyBwb3M9JykpKSArIChTdHJpbmcoaSkpKSkgKyAoJyBjaD0nKSkpICsgKGNoKSkpOwogICAgICAgIH0KICAgICAgICB0b2tlbnMucHVzaChuZXcgVG9rZW4oJ05FV0xJTkUnLCAnJywgbikpOwogICAgICAgIGxpbmVfaW5kZXggPSBsaW5lX2luZGV4ICsgMTsKICAgIH0KICAgIHRva2Vucy5wdXNoKG5ldyBUb2tlbignRU9GJywgJycsIHB5TGVuKGxpbmVzKSkpOwogICAgcmV0dXJuIHRva2VuczsKfQpjbGFzcyBQYXJzZXIgewogICAgY29uc3RydWN0b3IodG9rZW5zKSB7CiAgICAgICAgdGhpcy50b2tlbnMgPSB0b2tlbnM7CiAgICAgICAgdGhpcy5wb3MgPSAwOwogICAgICAgIHRoaXMuZXhwcl9ub2RlcyA9IHRoaXMubmV3X2V4cHJfbm9kZXMoKTsKICAgIH0KCiAgICBuZXdfZXhwcl9ub2RlcygpIHsKICAgICAgICBsZXQgbm9kZXMgPSBbXTsKICAgICAgICByZXR1cm4gbm9kZXM7CiAgICB9CgogICAgcGVla19raW5kKCkgewogICAgICAgIHJldHVybiB0aGlzLnRva2Vuc1t0aGlzLnBvc10ua2luZDsKICAgIH0KCiAgICBtYXRjaChraW5kKSB7CiAgICAgICAgaWYgKHB5Qm9vbCgoKHRoaXMucGVla19raW5kKCkpID09PSAoa2luZCkpKSkgewogICAgICAgICAgICB0aGlzLnBvcyA9IHRoaXMucG9zICsgMTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBleHBlY3Qoa2luZCkgewogICAgICAgIGlmIChweUJvb2woKCh0aGlzLnBlZWtfa2luZCgpKSAhPT0gKGtpbmQpKSkpIHsKICAgICAgICAgICAgbGV0IHQgPSB0aGlzLnRva2Vuc1t0aGlzLnBvc107CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoKCgoKCgoKCgoJ3BhcnNlIGVycm9yIGF0IHBvcz0nKSArIChTdHJpbmcodC5wb3MpKSkpICsgKCcsIGV4cGVjdGVkPScpKSkgKyAoa2luZCkpKSArICgnLCBnb3Q9JykpKSArICh0LmtpbmQpKSk7CiAgICAgICAgfQogICAgICAgIGxldCB0b2tlbiA9IHRoaXMudG9rZW5zW3RoaXMucG9zXTsKICAgICAgICB0aGlzLnBvcyA9IHRoaXMucG9zICsgMTsKICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgc2tpcF9uZXdsaW5lcygpIHsKICAgICAgICB3aGlsZSAocHlCb29sKHRoaXMubWF0Y2goJ05FV0xJTkUnKSkpIHsKICAgICAgICB9CiAgICB9CgogICAgYWRkX2V4cHIobm9kZSkgewogICAgICAgIHRoaXMuZXhwcl9ub2Rlcy5wdXNoKG5vZGUpOwogICAgICAgIHJldHVybiAoKHB5TGVuKHRoaXMuZXhwcl9ub2RlcykpIC0gKDEpKTsKICAgIH0KCiAgICBwYXJzZV9wcm9ncmFtKCkgewogICAgICAgIGxldCBzdG10cyA9IFtdOwogICAgICAgIHRoaXMuc2tpcF9uZXdsaW5lcygpOwogICAgICAgIHdoaWxlIChweUJvb2woKCh0aGlzLnBlZWtfa2luZCgpKSAhPT0gKCdFT0YnKSkpKSB7CiAgICAgICAgICAgIGxldCBzdG10ID0gdGhpcy5wYXJzZV9zdG10KCk7CiAgICAgICAgICAgIHN0bXRzLnB1c2goc3RtdCk7CiAgICAgICAgICAgIHRoaXMuc2tpcF9uZXdsaW5lcygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RtdHM7CiAgICB9CgogICAgcGFyc2Vfc3RtdCgpIHsKICAgICAgICBpZiAocHlCb29sKHRoaXMubWF0Y2goJ0xFVCcpKSkgewogICAgICAgICAgICBsZXQgbGV0X25hbWUgPSB0aGlzLmV4cGVjdCgnSURFTlQnKS50ZXh0OwogICAgICAgICAgICB0aGlzLmV4cGVjdCgnRVFVQUwnKTsKICAgICAgICAgICAgbGV0IGxldF9leHByX2luZGV4ID0gdGhpcy5wYXJzZV9leHByKCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3RtdE5vZGUoJ2xldCcsIGxldF9uYW1lLCBsZXRfZXhwcl9pbmRleCk7CiAgICAgICAgfQogICAgICAgIGlmIChweUJvb2wodGhpcy5tYXRjaCgnUFJJTlQnKSkpIHsKICAgICAgICAgICAgbGV0IHByaW50X2V4cHJfaW5kZXggPSB0aGlzLnBhcnNlX2V4cHIoKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdG10Tm9kZSgncHJpbnQnLCAnJywgcHJpbnRfZXhwcl9pbmRleCk7CiAgICAgICAgfQogICAgICAgIGxldCBhc3NpZ25fbmFtZSA9IHRoaXMuZXhwZWN0KCdJREVOVCcpLnRleHQ7CiAgICAgICAgdGhpcy5leHBlY3QoJ0VRVUFMJyk7CiAgICAgICAgbGV0IGFzc2lnbl9leHByX2luZGV4ID0gdGhpcy5wYXJzZV9leHByKCk7CiAgICAgICAgcmV0dXJuIG5ldyBTdG10Tm9kZSgnYXNzaWduJywgYXNzaWduX25hbWUsIGFzc2lnbl9leHByX2luZGV4KTsKICAgIH0KCiAgICBwYXJzZV9leHByKCkgewogICAgICAgIHJldHVybiB0aGlzLnBhcnNlX2FkZCgpOwogICAgfQoKICAgIHBhcnNlX2FkZCgpIHsKICAgICAgICBsZXQgbGVmdCA9IHRoaXMucGFyc2VfbXVsKCk7CiAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTsKICAgICAgICB3aGlsZSAocHlCb29sKCghcHlCb29sKGRvbmUpKSkpIHsKICAgICAgICAgICAgaWYgKHB5Qm9vbCh0aGlzLm1hdGNoKCdQTFVTJykpKSB7CiAgICAgICAgICAgICAgICBsZXQgcmlnaHQgPSB0aGlzLnBhcnNlX211bCgpOwogICAgICAgICAgICAgICAgbGVmdCA9IHRoaXMuYWRkX2V4cHIobmV3IEV4cHJOb2RlKCdiaW4nLCAwLCAnJywgJysnLCBsZWZ0LCByaWdodCkpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHB5Qm9vbCh0aGlzLm1hdGNoKCdNSU5VUycpKSkgewogICAgICAgICAgICAgICAgbGV0IHJpZ2h0ID0gdGhpcy5wYXJzZV9tdWwoKTsKICAgICAgICAgICAgICAgIGxlZnQgPSB0aGlzLmFkZF9leHByKG5ldyBFeHByTm9kZSgnYmluJywgMCwgJycsICctJywgbGVmdCwgcmlnaHQpKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVmdDsKICAgIH0KCiAgICBwYXJzZV9tdWwoKSB7CiAgICAgICAgbGV0IGxlZnQgPSB0aGlzLnBhcnNlX3VuYXJ5KCk7CiAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTsKICAgICAgICB3aGlsZSAocHlCb29sKCghcHlCb29sKGRvbmUpKSkpIHsKICAgICAgICAgICAgaWYgKHB5Qm9vbCh0aGlzLm1hdGNoKCdTVEFSJykpKSB7CiAgICAgICAgICAgICAgICBsZXQgcmlnaHQgPSB0aGlzLnBhcnNlX3VuYXJ5KCk7CiAgICAgICAgICAgICAgICBsZWZ0ID0gdGhpcy5hZGRfZXhwcihuZXcgRXhwck5vZGUoJ2JpbicsIDAsICcnLCAnKicsIGxlZnQsIHJpZ2h0KSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHlCb29sKHRoaXMubWF0Y2goJ1NMQVNIJykpKSB7CiAgICAgICAgICAgICAgICBsZXQgcmlnaHQgPSB0aGlzLnBhcnNlX3VuYXJ5KCk7CiAgICAgICAgICAgICAgICBsZWZ0ID0gdGhpcy5hZGRfZXhwcihuZXcgRXhwck5vZGUoJ2JpbicsIDAsICcnLCAnLycsIGxlZnQsIHJpZ2h0KSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlZnQ7CiAgICB9CgogICAgcGFyc2VfdW5hcnkoKSB7CiAgICAgICAgaWYgKHB5Qm9vbCh0aGlzLm1hdGNoKCdNSU5VUycpKSkgewogICAgICAgICAgICBsZXQgY2hpbGQgPSB0aGlzLnBhcnNlX3VuYXJ5KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZF9leHByKG5ldyBFeHByTm9kZSgnbmVnJywgMCwgJycsICcnLCBjaGlsZCwgKC0oMSkpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnBhcnNlX3ByaW1hcnkoKTsKICAgIH0KCiAgICBwYXJzZV9wcmltYXJ5KCkgewogICAgICAgIGlmIChweUJvb2wodGhpcy5tYXRjaCgnTlVNQkVSJykpKSB7CiAgICAgICAgICAgIGxldCB0b2tlbl9udW0gPSB0aGlzLnRva2Vuc1soKHRoaXMucG9zKSAtICgxKSldOwogICAgICAgICAgICBsZXQgcGFyc2VkX3ZhbHVlID0gMDsKICAgICAgICAgICAgbGV0IGlkeCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChweUJvb2woKChpZHgpIDwgKHB5TGVuKHRva2VuX251bS50ZXh0KSkpKSkgewogICAgICAgICAgICAgICAgbGV0IGNoID0gcHlTbGljZSh0b2tlbl9udW0udGV4dCwgaWR4LCAoKGlkeCkgKyAoMSkpKTsKICAgICAgICAgICAgICAgIHBhcnNlZF92YWx1ZSA9ICgoKCgoKHBhcnNlZF92YWx1ZSkgKiAoMTApKSkgKyAocHlPcmQoY2gpKSkpIC0gKHB5T3JkKCcwJykpKTsKICAgICAgICAgICAgICAgIGlkeCA9IGlkeCArIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkX2V4cHIobmV3IEV4cHJOb2RlKCdsaXQnLCBwYXJzZWRfdmFsdWUsICcnLCAnJywgKC0oMSkpLCAoLSgxKSkpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHB5Qm9vbCh0aGlzLm1hdGNoKCdJREVOVCcpKSkgewogICAgICAgICAgICBsZXQgdG9rZW5faWRlbnQgPSB0aGlzLnRva2Vuc1soKHRoaXMucG9zKSAtICgxKSldOwogICAgICAgICAgICByZXR1cm4gdGhpcy5hZGRfZXhwcihuZXcgRXhwck5vZGUoJ3ZhcicsIDAsIHRva2VuX2lkZW50LnRleHQsICcnLCAoLSgxKSksICgtKDEpKSkpOwogICAgICAgIH0KICAgICAgICBpZiAocHlCb29sKHRoaXMubWF0Y2goJ0xQQVJFTicpKSkgewogICAgICAgICAgICBsZXQgZXhwcl9pbmRleCA9IHRoaXMucGFyc2VfZXhwcigpOwogICAgICAgICAgICB0aGlzLmV4cGVjdCgnUlBBUkVOJyk7CiAgICAgICAgICAgIHJldHVybiBleHByX2luZGV4OwogICAgICAgIH0KICAgICAgICBsZXQgdCA9IHRoaXMudG9rZW5zW3RoaXMucG9zXTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKCgoKCgoJ3ByaW1hcnkgcGFyc2UgZXJyb3IgYXQgcG9zPScpICsgKFN0cmluZyh0LnBvcykpKSkgKyAoJyBnb3Q9JykpKSArICh0LmtpbmQpKSk7CiAgICB9Cn0KZnVuY3Rpb24gZXZhbF9leHByKGV4cHJfaW5kZXgsIGV4cHJfbm9kZXMsIGVudikgewogICAgaWYgKHB5Qm9vbChmYWxzZSkpIHsKICAgICAgICBlbnZbJ19fZHVtbXlfXyddID0gMDsKICAgIH0KICAgIGxldCBub2RlID0gZXhwcl9ub2Rlc1tleHByX2luZGV4XTsKICAgIGlmIChweUJvb2woKChub2RlLmtpbmQpID09PSAoJ2xpdCcpKSkpIHsKICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTsKICAgIH0KICAgIGlmIChweUJvb2woKChub2RlLmtpbmQpID09PSAoJ3ZhcicpKSkpIHsKICAgICAgICBpZiAocHlCb29sKCghcHlCb29sKHB5SW4obm9kZS5uYW1lLCBlbnYpKSkpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoKCd1bmRlZmluZWQgdmFyaWFibGU6ICcpICsgKG5vZGUubmFtZSkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVudltub2RlLm5hbWVdOwogICAgfQogICAgaWYgKHB5Qm9vbCgoKG5vZGUua2luZCkgPT09ICgnbmVnJykpKSkgewogICAgICAgIHJldHVybiAoLShldmFsX2V4cHIobm9kZS5sZWZ0LCBleHByX25vZGVzLCBlbnYpKSk7CiAgICB9CiAgICBpZiAocHlCb29sKCgobm9kZS5raW5kKSA9PT0gKCdiaW4nKSkpKSB7CiAgICAgICAgbGV0IGxocyA9IGV2YWxfZXhwcihub2RlLmxlZnQsIGV4cHJfbm9kZXMsIGVudik7CiAgICAgICAgbGV0IHJocyA9IGV2YWxfZXhwcihub2RlLnJpZ2h0LCBleHByX25vZGVzLCBlbnYpOwogICAgICAgIGlmIChweUJvb2woKChub2RlLm9wKSA9PT0gKCcrJykpKSkgewogICAgICAgICAgICByZXR1cm4gKChsaHMpICsgKHJocykpOwogICAgICAgIH0KICAgICAgICBpZiAocHlCb29sKCgobm9kZS5vcCkgPT09ICgnLScpKSkpIHsKICAgICAgICAgICAgcmV0dXJuICgobGhzKSAtIChyaHMpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHB5Qm9vbCgoKG5vZGUub3ApID09PSAoJyonKSkpKSB7CiAgICAgICAgICAgIHJldHVybiAoKGxocykgKiAocmhzKSk7CiAgICAgICAgfQogICAgICAgIGlmIChweUJvb2woKChub2RlLm9wKSA9PT0gKCcvJykpKSkgewogICAgICAgICAgICBpZiAocHlCb29sKCgocmhzKSA9PT0gKDApKSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZGl2aXNpb24gYnkgemVybycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBweUZsb29yRGl2KGxocywgcmhzKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCgoJ3Vua25vd24gb3BlcmF0b3I6ICcpICsgKG5vZGUub3ApKSk7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoKCgndW5rbm93biBub2RlIGtpbmQ6ICcpICsgKG5vZGUua2luZCkpKTsKfQpmdW5jdGlvbiBleGVjdXRlKHN0bXRzLCBleHByX25vZGVzLCB0cmFjZSkgewogICAgbGV0IGVudiA9IE9iamVjdC5mcm9tRW50cmllcyhbXSk7CiAgICBsZXQgY2hlY2tzdW0gPSAwOwogICAgbGV0IHByaW50ZWQgPSAwOwogICAgbGV0IHN0bXQ7CiAgICBmb3IgKGNvbnN0IF9fcHl0cmFfaXRfMSBvZiBzdG10cykgewogICAgICAgIHN0bXQgPSBfX3B5dHJhX2l0XzE7CiAgICAgICAgaWYgKHB5Qm9vbCgoKHN0bXQua2luZCkgPT09ICgnbGV0JykpKSkgewogICAgICAgICAgICBlbnZbc3RtdC5uYW1lXSA9IGV2YWxfZXhwcihzdG10LmV4cHJfaW5kZXgsIGV4cHJfbm9kZXMsIGVudik7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAocHlCb29sKCgoc3RtdC5raW5kKSA9PT0gKCdhc3NpZ24nKSkpKSB7CiAgICAgICAgICAgIGlmIChweUJvb2woKCFweUJvb2wocHlJbihzdG10Lm5hbWUsIGVudikpKSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoKCdhc3NpZ24gdG8gdW5kZWZpbmVkIHZhcmlhYmxlOiAnKSArIChzdG10Lm5hbWUpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW52W3N0bXQubmFtZV0gPSBldmFsX2V4cHIoc3RtdC5leHByX2luZGV4LCBleHByX25vZGVzLCBlbnYpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IHZhbHVlID0gZXZhbF9leHByKHN0bXQuZXhwcl9pbmRleCwgZXhwcl9ub2RlcywgZW52KTsKICAgICAgICBpZiAocHlCb29sKHRyYWNlKSkgewogICAgICAgICAgICBweVByaW50KHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgbGV0IG5vcm0gPSBweU1vZCh2YWx1ZSwgMTAwMDAwMDAwNyk7CiAgICAgICAgaWYgKHB5Qm9vbCgoKG5vcm0pIDwgKDApKSkpIHsKICAgICAgICAgICAgbm9ybSA9IG5vcm0gKyAxMDAwMDAwMDA3OwogICAgICAgIH0KICAgICAgICBjaGVja3N1bSA9IHB5TW9kKCgoKChjaGVja3N1bSkgKiAoMTMxKSkpICsgKG5vcm0pKSwgMTAwMDAwMDAwNyk7CiAgICAgICAgcHJpbnRlZCA9IHByaW50ZWQgKyAxOwogICAgfQogICAgaWYgKHB5Qm9vbCh0cmFjZSkpIHsKICAgICAgICBweVByaW50KCdwcmludGVkOicsIHByaW50ZWQpOwogICAgfQogICAgcmV0dXJuIGNoZWNrc3VtOwp9CmZ1bmN0aW9uIGJ1aWxkX2JlbmNobWFya19zb3VyY2UodmFyX2NvdW50LCBsb29wcykgewogICAgbGV0IGxpbmVzID0gW107CiAgICBsZXQgaTsKICAgIGZvciAobGV0IF9fcHl0cmFfaV8yID0gMDsgX19weXRyYV9pXzIgPCB2YXJfY291bnQ7IF9fcHl0cmFfaV8yICs9IDEpIHsKICAgICAgICBpID0gX19weXRyYV9pXzI7CiAgICAgICAgbGluZXMucHVzaCgoKCgoKCgnbGV0IHYnKSArIChTdHJpbmcoaSkpKSkgKyAoJyA9ICcpKSkgKyAoU3RyaW5nKCgoaSkgKyAoMSkpKSkpKTsKICAgIH0KICAgIGZvciAobGV0IF9fcHl0cmFfaV8zID0gMDsgX19weXRyYV9pXzMgPCBsb29wczsgX19weXRyYV9pXzMgKz0gMSkgewogICAgICAgIGkgPSBfX3B5dHJhX2lfMzsKICAgICAgICBsZXQgeCA9IHB5TW9kKGksIHZhcl9jb3VudCk7CiAgICAgICAgbGV0IHkgPSBweU1vZCgoKGkpICsgKDMpKSwgdmFyX2NvdW50KTsKICAgICAgICBsZXQgYzEgPSAoKHB5TW9kKGksIDcpKSArICgxKSk7CiAgICAgICAgbGV0IGMyID0gKChweU1vZChpLCAxMSkpICsgKDIpKTsKICAgICAgICBsaW5lcy5wdXNoKCgoKCgoKCgoKCgoKCgoKCgoKCd2JykgKyAoU3RyaW5nKHgpKSkpICsgKCcgPSAodicpKSkgKyAoU3RyaW5nKHgpKSkpICsgKCcgKiAnKSkpICsgKFN0cmluZyhjMSkpKSkgKyAoJyArIHYnKSkpICsgKFN0cmluZyh5KSkpKSArICgnICsgMTAwMDApIC8gJykpKSArIChTdHJpbmcoYzIpKSkpOwogICAgICAgIGlmIChweUJvb2woKChweU1vZChpLCA5NykpID09PSAoMCkpKSkgewogICAgICAgICAgICBsaW5lcy5wdXNoKCgoJ3ByaW50IHYnKSArIChTdHJpbmcoeCkpKSk7CiAgICAgICAgfQogICAgfQogICAgbGluZXMucHVzaCgncHJpbnQgKHYwICsgdjEgKyB2MiArIHYzKScpOwogICAgcmV0dXJuIGxpbmVzOwp9CmZ1bmN0aW9uIHJ1bl9kZW1vKCkgewogICAgbGV0IGRlbW9fbGluZXMgPSBbXTsKICAgIGRlbW9fbGluZXMucHVzaCgnbGV0IGEgPSAxMCcpOwogICAgZGVtb19saW5lcy5wdXNoKCdsZXQgYiA9IDMnKTsKICAgIGRlbW9fbGluZXMucHVzaCgnYSA9IChhICsgYikgKiAyJyk7CiAgICBkZW1vX2xpbmVzLnB1c2goJ3ByaW50IGEnKTsKICAgIGRlbW9fbGluZXMucHVzaCgncHJpbnQgYSAvIGInKTsKICAgIGxldCB0b2tlbnMgPSB0b2tlbml6ZShkZW1vX2xpbmVzKTsKICAgIGxldCBwYXJzZXIgPSBuZXcgUGFyc2VyKHRva2Vucyk7CiAgICBsZXQgc3RtdHMgPSBwYXJzZXIucGFyc2VfcHJvZ3JhbSgpOwogICAgbGV0IGNoZWNrc3VtID0gZXhlY3V0ZShzdG10cywgcGFyc2VyLmV4cHJfbm9kZXMsIHRydWUpOwogICAgcHlQcmludCgnZGVtb19jaGVja3N1bTonLCBjaGVja3N1bSk7Cn0KZnVuY3Rpb24gcnVuX2JlbmNobWFyaygpIHsKICAgIGxldCBzb3VyY2VfbGluZXMgPSBidWlsZF9iZW5jaG1hcmtfc291cmNlKDMyLCAxMjAwMDApOwogICAgbGV0IHN0YXJ0ID0gcGVyZl9jb3VudGVyKCk7CiAgICBsZXQgdG9rZW5zID0gdG9rZW5pemUoc291cmNlX2xpbmVzKTsKICAgIGxldCBwYXJzZXIgPSBuZXcgUGFyc2VyKHRva2Vucyk7CiAgICBsZXQgc3RtdHMgPSBwYXJzZXIucGFyc2VfcHJvZ3JhbSgpOwogICAgbGV0IGNoZWNrc3VtID0gZXhlY3V0ZShzdG10cywgcGFyc2VyLmV4cHJfbm9kZXMsIGZhbHNlKTsKICAgIGxldCBlbGFwc2VkID0gKChwZXJmX2NvdW50ZXIoKSkgLSAoc3RhcnQpKTsKICAgIHB5UHJpbnQoJ3Rva2VuX2NvdW50OicsIHB5TGVuKHRva2VucykpOwogICAgcHlQcmludCgnZXhwcl9jb3VudDonLCBweUxlbihwYXJzZXIuZXhwcl9ub2RlcykpOwogICAgcHlQcmludCgnc3RtdF9jb3VudDonLCBweUxlbihzdG10cykpOwogICAgcHlQcmludCgnY2hlY2tzdW06JywgY2hlY2tzdW0pOwogICAgcHlQcmludCgnZWxhcHNlZF9zZWM6JywgZWxhcHNlZCk7Cn0KZnVuY3Rpb24gbWFpbigpIHsKICAgIHJ1bl9kZW1vKCk7CiAgICBydW5fYmVuY2htYXJrKCk7Cn0KbWFpbigpOwo="

        // エントリポイント。
        @JvmStatic
        fun main(args: Array<String>) {
            val code = PyRuntime.runEmbeddedNode(PYTRA_EMBEDDED_JS_BASE64, args)
            kotlin.system.exitProcess(code)
        }
    }
}

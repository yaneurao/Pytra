// このファイルは自動生成です（Python -> Swift node-backed mode）。

// Swift 実行向け Node.js ランタイム補助。

import Foundation

/// Base64 で埋め込まれた JavaScript ソースコードを一時ファイルへ展開し、node で実行する。
/// - Parameters:
///   - sourceBase64: JavaScript ソースコードの Base64 文字列。
///   - args: JavaScript 側へ渡す引数配列。
/// - Returns:
///   node プロセスの終了コード。失敗時は 1 を返す。
func pytraRunEmbeddedNode(_ sourceBase64: String, _ args: [String]) -> Int32 {
    guard let sourceData = Data(base64Encoded: sourceBase64) else {
        fputs("error: failed to decode embedded JavaScript source\n", stderr)
        return 1
    }

    let tmpDir = URL(fileURLWithPath: NSTemporaryDirectory(), isDirectory: true)
    let fileName = "pytra_embedded_\(UUID().uuidString).js"
    let scriptURL = tmpDir.appendingPathComponent(fileName)

    do {
        try sourceData.write(to: scriptURL)
    } catch {
        fputs("error: failed to write temporary JavaScript file: \(error)\n", stderr)
        return 1
    }

    let process = Process()
    process.executableURL = URL(fileURLWithPath: "/usr/bin/env")
    process.arguments = ["node", scriptURL.path] + args
    process.environment = ProcessInfo.processInfo.environment
    process.standardInput = FileHandle.standardInput
    process.standardOutput = FileHandle.standardOutput
    process.standardError = FileHandle.standardError

    do {
        try process.run()
        process.waitUntilExit()
    } catch {
        fputs("error: failed to launch node: \(error)\n", stderr)
        try? FileManager.default.removeItem(at: scriptURL)
        return 1
    }

    try? FileManager.default.removeItem(at: scriptURL)
    return process.terminationStatus
}

// 埋め込み JavaScript ソース（Base64）。
let pytraEmbeddedJsBase64 = "Ly8gZ2VuZXJhdGVkIGludGVybmFsIEphdmFTY3JpcHQKCmNvbnN0IF9fcHl0cmFfcm9vdCA9IHByb2Nlc3MuY3dkKCk7CmNvbnN0IHB5X3J1bnRpbWUgPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS9weV9ydW50aW1lLmpzJyk7CmNvbnN0IHB5X21hdGggPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS9tYXRoLmpzJyk7CmNvbnN0IHB5X3RpbWUgPSByZXF1aXJlKF9fcHl0cmFfcm9vdCArICcvc3JjL2pzX21vZHVsZS90aW1lLmpzJyk7CmNvbnN0IHsgcHlQcmludCwgcHlMZW4sIHB5Qm9vbCwgcHlSYW5nZSwgcHlGbG9vckRpdiwgcHlNb2QsIHB5SW4sIHB5U2xpY2UsIHB5T3JkLCBweUNociwgcHlCeXRlYXJyYXksIHB5Qnl0ZXMsIHB5SXNEaWdpdCwgcHlJc0FscGhhIH0gPSBweV9ydW50aW1lOwpjb25zdCB7IHBlcmZDb3VudGVyIH0gPSBweV90aW1lOwpjb25zdCBtYXRoID0gcmVxdWlyZShfX3B5dHJhX3Jvb3QgKyAnL3NyYy9qc19tb2R1bGUvbWF0aC5qcycpOwpjb25zdCBwbmdfaGVscGVyID0gcmVxdWlyZShfX3B5dHJhX3Jvb3QgKyAnL3NyYy9qc19tb2R1bGUvcG5nX2hlbHBlci5qcycpOwpjb25zdCBwZXJmX2NvdW50ZXIgPSBwZXJmQ291bnRlcjsKCmZ1bmN0aW9uIGNsYW1wMDEodikgewogICAgaWYgKHB5Qm9vbCgoKHYpIDwgKDAuMCkpKSkgewogICAgICAgIHJldHVybiAwLjA7CiAgICB9CiAgICBpZiAocHlCb29sKCgodikgPiAoMS4wKSkpKSB7CiAgICAgICAgcmV0dXJuIDEuMDsKICAgIH0KICAgIHJldHVybiB2Owp9CmZ1bmN0aW9uIGhpdF9zcGhlcmUob3gsIG95LCBveiwgZHgsIGR5LCBkeiwgY3gsIGN5LCBjeiwgcikgewogICAgbGV0IGx4ID0gKChveCkgLSAoY3gpKTsKICAgIGxldCBseSA9ICgob3kpIC0gKGN5KSk7CiAgICBsZXQgbHogPSAoKG96KSAtIChjeikpOwogICAgbGV0IGEgPSAoKCgoKChkeCkgKiAoZHgpKSkgKyAoKChkeSkgKiAoZHkpKSkpKSArICgoKGR6KSAqIChkeikpKSk7CiAgICBsZXQgYiA9ICgoMi4wKSAqICgoKCgoKChseCkgKiAoZHgpKSkgKyAoKChseSkgKiAoZHkpKSkpKSArICgoKGx6KSAqIChkeikpKSkpKTsKICAgIGxldCBjID0gKCgoKCgoKChseCkgKiAobHgpKSkgKyAoKChseSkgKiAobHkpKSkpKSArICgoKGx6KSAqIChseikpKSkpIC0gKCgocikgKiAocikpKSk7CiAgICBsZXQgZCA9ICgoKChiKSAqIChiKSkpIC0gKCgoKCg0LjApICogKGEpKSkgKiAoYykpKSk7CiAgICBpZiAocHlCb29sKCgoZCkgPCAoMC4wKSkpKSB7CiAgICAgICAgcmV0dXJuICgtKDEuMCkpOwogICAgfQogICAgbGV0IHNkID0gbWF0aC5zcXJ0KGQpOwogICAgbGV0IHQwID0gKCgoKCgtKGIpKSkgLSAoc2QpKSkgLyAoKCgyLjApICogKGEpKSkpOwogICAgbGV0IHQxID0gKCgoKCgtKGIpKSkgKyAoc2QpKSkgLyAoKCgyLjApICogKGEpKSkpOwogICAgaWYgKHB5Qm9vbCgoKHQwKSA+ICgwLjAwMSkpKSkgewogICAgICAgIHJldHVybiB0MDsKICAgIH0KICAgIGlmIChweUJvb2woKCh0MSkgPiAoMC4wMDEpKSkpIHsKICAgICAgICByZXR1cm4gdDE7CiAgICB9CiAgICByZXR1cm4gKC0oMS4wKSk7Cn0KZnVuY3Rpb24gcmVuZGVyKHdpZHRoLCBoZWlnaHQsIGFhKSB7CiAgICBsZXQgcGl4ZWxzID0gcHlCeXRlYXJyYXkoKTsKICAgIGxldCBveCA9IDAuMDsKICAgIGxldCBveSA9IDAuMDsKICAgIGxldCBveiA9ICgtKDMuMCkpOwogICAgbGV0IGx4ID0gKC0oMC40KSk7CiAgICBsZXQgbHkgPSAwLjg7CiAgICBsZXQgbHogPSAoLSgwLjQ1KSk7CiAgICBsZXQgeTsKICAgIGZvciAobGV0IF9fcHl0cmFfaV8xID0gMDsgX19weXRyYV9pXzEgPCBoZWlnaHQ7IF9fcHl0cmFfaV8xICs9IDEpIHsKICAgICAgICB5ID0gX19weXRyYV9pXzE7CiAgICAgICAgbGV0IHg7CiAgICAgICAgZm9yIChsZXQgX19weXRyYV9pXzIgPSAwOyBfX3B5dHJhX2lfMiA8IHdpZHRoOyBfX3B5dHJhX2lfMiArPSAxKSB7CiAgICAgICAgICAgIHggPSBfX3B5dHJhX2lfMjsKICAgICAgICAgICAgbGV0IGFyID0gMDsKICAgICAgICAgICAgbGV0IGFnID0gMDsKICAgICAgICAgICAgbGV0IGFiID0gMDsKICAgICAgICAgICAgbGV0IGF5OwogICAgICAgICAgICBmb3IgKGxldCBfX3B5dHJhX2lfMyA9IDA7IF9fcHl0cmFfaV8zIDwgYWE7IF9fcHl0cmFfaV8zICs9IDEpIHsKICAgICAgICAgICAgICAgIGF5ID0gX19weXRyYV9pXzM7CiAgICAgICAgICAgICAgICBsZXQgYXg7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBfX3B5dHJhX2lfNCA9IDA7IF9fcHl0cmFfaV80IDwgYWE7IF9fcHl0cmFfaV80ICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBheCA9IF9fcHl0cmFfaV80OwogICAgICAgICAgICAgICAgICAgIGxldCBmeSA9ICgoKCh5KSArICgoKCgoYXkpICsgKDAuNSkpKSAvIChhYSkpKSkpIC8gKCgoaGVpZ2h0KSAtICgxKSkpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgZnggPSAoKCgoeCkgKyAoKCgoKGF4KSArICgwLjUpKSkgLyAoYWEpKSkpKSAvICgoKHdpZHRoKSAtICgxKSkpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3kgPSAoKDEuMCkgLSAoKCgyLjApICogKGZ5KSkpKTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3ggPSAoKCgoKCgyLjApICogKGZ4KSkpIC0gKDEuMCkpKSAqICgoKHdpZHRoKSAvIChoZWlnaHQpKSkpOwogICAgICAgICAgICAgICAgICAgIGxldCBkeCA9IHN4OwogICAgICAgICAgICAgICAgICAgIGxldCBkeSA9IHN5OwogICAgICAgICAgICAgICAgICAgIGxldCBkeiA9IDEuMDsKICAgICAgICAgICAgICAgICAgICBsZXQgaW52X2xlbiA9ICgoMS4wKSAvIChtYXRoLnNxcnQoKCgoKCgoZHgpICogKGR4KSkpICsgKCgoZHkpICogKGR5KSkpKSkgKyAoKChkeikgKiAoZHopKSkpKSkpOwogICAgICAgICAgICAgICAgICAgIGR4ID0gZHggKiBpbnZfbGVuOwogICAgICAgICAgICAgICAgICAgIGR5ID0gZHkgKiBpbnZfbGVuOwogICAgICAgICAgICAgICAgICAgIGR6ID0gZHogKiBpbnZfbGVuOwogICAgICAgICAgICAgICAgICAgIGxldCB0X21pbiA9IDFlKzMwOwogICAgICAgICAgICAgICAgICAgIGxldCBoaXRfaWQgPSAoLSgxKSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHQgPSBoaXRfc3BoZXJlKG94LCBveSwgb3osIGR4LCBkeSwgZHosICgtKDAuOCkpLCAoLSgwLjIpKSwgMi4yLCAwLjgpOwogICAgICAgICAgICAgICAgICAgIGlmIChweUJvb2woKCgodCkgPiAoMC4wKSkgJiYgKCh0KSA8ICh0X21pbikpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdF9taW4gPSB0OwogICAgICAgICAgICAgICAgICAgICAgICBoaXRfaWQgPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0ID0gaGl0X3NwaGVyZShveCwgb3ksIG96LCBkeCwgZHksIGR6LCAwLjksIDAuMSwgMi45LCAwLjk1KTsKICAgICAgICAgICAgICAgICAgICBpZiAocHlCb29sKCgoKHQpID4gKDAuMCkpICYmICgodCkgPCAodF9taW4pKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRfbWluID0gdDsKICAgICAgICAgICAgICAgICAgICAgICAgaGl0X2lkID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdCA9IGhpdF9zcGhlcmUob3gsIG95LCBveiwgZHgsIGR5LCBkeiwgMC4wLCAoLSgxMDAxLjApKSwgMy4wLCAxMDAwLjApOwogICAgICAgICAgICAgICAgICAgIGlmIChweUJvb2woKCgodCkgPiAoMC4wKSkgJiYgKCh0KSA8ICh0X21pbikpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdF9taW4gPSB0OwogICAgICAgICAgICAgICAgICAgICAgICBoaXRfaWQgPSAyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsZXQgciA9IDA7CiAgICAgICAgICAgICAgICAgICAgbGV0IGcgPSAwOwogICAgICAgICAgICAgICAgICAgIGxldCBiID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAocHlCb29sKCgoaGl0X2lkKSA+PSAoMCkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHggPSAoKG94KSArICgoKGR4KSAqICh0X21pbikpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBweSA9ICgob3kpICsgKCgoZHkpICogKHRfbWluKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHB6ID0gKChveikgKyAoKChkeikgKiAodF9taW4pKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbnggPSAwLjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBueSA9IDAuMDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG56ID0gMC4wOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHlCb29sKCgoaGl0X2lkKSA9PT0gKDApKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG54ID0gKCgoKHB4KSArICgwLjgpKSkgLyAoMC44KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBueSA9ICgoKChweSkgKyAoMC4yKSkpIC8gKDAuOCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnogPSAoKCgocHopIC0gKDIuMikpKSAvICgwLjgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChweUJvb2woKChoaXRfaWQpID09PSAoMSkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG54ID0gKCgoKHB4KSAtICgwLjkpKSkgLyAoMC45NSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG55ID0gKCgoKHB5KSAtICgwLjEpKSkgLyAoMC45NSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG56ID0gKCgoKHB6KSAtICgyLjkpKSkgLyAoMC45NSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBueCA9IDAuMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBueSA9IDEuMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBueiA9IDAuMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlmZiA9ICgoKCgoKG54KSAqICgoLShseCkpKSkpICsgKCgobnkpICogKCgtKGx5KSkpKSkpKSArICgoKG56KSAqICgoLShseikpKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGNsYW1wMDEoZGlmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiYXNlX3IgPSAwLjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiYXNlX2cgPSAwLjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiYXNlX2IgPSAwLjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChweUJvb2woKChoaXRfaWQpID09PSAoMCkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9yID0gMC45NTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfZyA9IDAuMzU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2IgPSAwLjI1OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHB5Qm9vbCgoKGhpdF9pZCkgPT09ICgxKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9yID0gMC4yNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2cgPSAwLjU1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfYiA9IDAuOTU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaGVja2VyID0gKChNYXRoLnRydW5jKE51bWJlcigoKCgocHgpICsgKDUwLjApKSkgKiAoMC44KSkpKSkgKyAoTWF0aC50cnVuYyhOdW1iZXIoKCgoKHB6KSArICg1MC4wKSkpICogKDAuOCkpKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHlCb29sKCgocHlNb2QoY2hlY2tlciwgMikpID09PSAoMCkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX3IgPSAwLjg1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2cgPSAwLjg1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2IgPSAwLjg1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfciA9IDAuMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9nID0gMC4yOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2IgPSAwLjI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaGFkZSA9ICgoMC4xMikgKyAoKCgwLjg4KSAqIChkaWZmKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgciA9IE1hdGgudHJ1bmMoTnVtYmVyKCgoMjU1LjApICogKGNsYW1wMDEoKChiYXNlX3IpICogKHNoYWRlKSkpKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IE1hdGgudHJ1bmMoTnVtYmVyKCgoMjU1LjApICogKGNsYW1wMDEoKChiYXNlX2cpICogKHNoYWRlKSkpKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IE1hdGgudHJ1bmMoTnVtYmVyKCgoMjU1LjApICogKGNsYW1wMDEoKChiYXNlX2IpICogKHNoYWRlKSkpKSkpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHNreSA9ICgoMC41KSAqICgoKGR5KSArICgxLjApKSkpOwogICAgICAgICAgICAgICAgICAgICAgICByID0gTWF0aC50cnVuYyhOdW1iZXIoKCgyNTUuMCkgKiAoKCgwLjY1KSArICgoKDAuMikgKiAodHNreSkpKSkpKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBnID0gTWF0aC50cnVuYyhOdW1iZXIoKCgyNTUuMCkgKiAoKCgwLjc1KSArICgoKDAuMTgpICogKHRza3kpKSkpKSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IE1hdGgudHJ1bmMoTnVtYmVyKCgoMjU1LjApICogKCgoMC45KSArICgoKDAuMDgpICogKHRza3kpKSkpKSkpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXIgPSBhciArIHI7CiAgICAgICAgICAgICAgICAgICAgYWcgPSBhZyArIGc7CiAgICAgICAgICAgICAgICAgICAgYWIgPSBhYiArIGI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IHNhbXBsZXMgPSAoKGFhKSAqIChhYSkpOwogICAgICAgICAgICBwaXhlbHMucHVzaChweUZsb29yRGl2KGFyLCBzYW1wbGVzKSk7CiAgICAgICAgICAgIHBpeGVscy5wdXNoKHB5Rmxvb3JEaXYoYWcsIHNhbXBsZXMpKTsKICAgICAgICAgICAgcGl4ZWxzLnB1c2gocHlGbG9vckRpdihhYiwgc2FtcGxlcykpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBwaXhlbHM7Cn0KZnVuY3Rpb24gcnVuX3JheXRyYWNlKCkgewogICAgbGV0IHdpZHRoID0gMTYwMDsKICAgIGxldCBoZWlnaHQgPSA5MDA7CiAgICBsZXQgYWEgPSAyOwogICAgbGV0IG91dF9wYXRoID0gJ3NhbXBsZS9vdXQvcmF5dHJhY2VfMDIucG5nJzsKICAgIGxldCBzdGFydCA9IHBlcmZfY291bnRlcigpOwogICAgbGV0IHBpeGVscyA9IHJlbmRlcih3aWR0aCwgaGVpZ2h0LCBhYSk7CiAgICBwbmdfaGVscGVyLndyaXRlX3JnYl9wbmcob3V0X3BhdGgsIHdpZHRoLCBoZWlnaHQsIHBpeGVscyk7CiAgICBsZXQgZWxhcHNlZCA9ICgocGVyZl9jb3VudGVyKCkpIC0gKHN0YXJ0KSk7CiAgICBweVByaW50KCdvdXRwdXQ6Jywgb3V0X3BhdGgpOwogICAgcHlQcmludCgnc2l6ZTonLCB3aWR0aCwgJ3gnLCBoZWlnaHQpOwogICAgcHlQcmludCgnZWxhcHNlZF9zZWM6JywgZWxhcHNlZCk7Cn0KcnVuX3JheXRyYWNlKCk7Cg=="
let pytraArgs = Array(CommandLine.arguments.dropFirst())
let pytraCode = pytraRunEmbeddedNode(pytraEmbeddedJsBase64, pytraArgs)
Foundation.exit(pytraCode)

# TODO履歴（2026-02-22）

<a href="../../docs/todo-history/20260222.md">
  <img alt="Read in English" src="https://img.shields.io/badge/docs-English-2563EB?style=flat-square">
</a>

## 2026-02-22 完了: `render_expr` Call 分岐（builtin/module/method）分離タスクの完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Split render_expr Call branches (builtin/module/method) by feature and migrate to CodeEmitter helpers` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` の `Call` 分岐が feature helper（`_render_builtin_call` / `_render_call_module_method` / `_render_call_attribute_non_module` / fallback）へ分離済みであることを確認した。
   - [x] `src/py2cpp.py` の `Call` 前処理/owner解決が `CodeEmitter` 共通 helper（`_prepare_call_parts` / `resolve_call_attribute_context`）経由になり、重複ローカル helper を削除したことを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: `render_expr` 算術/比較/型変換分離タスクの完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Split arithmetic/comparison/type-conversion branches in render_expr into independent functions, switchable via profile/hooks` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` で演算系分岐が `_render_operator_family_expr` に集約され、`_render_binop_expr` / `_render_unary_expr` / `_render_compare_expr` / `_render_ifexp_expr` へ分離済みであることを確認した。
   - [x] `src/py2cpp.py` の `render_expr` が `hook_on_render_expr_kind(...)` を先行適用し、`BinOp` は `hook_on_render_binop(...)` 経由で上書き可能であることを確認した。
   - [x] `src/py2cpp.py` の型変換分岐（`int/float/bool`）が `_render_scalar_cast_builtin_call` へ独立していることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: 未使用/重複関数クリーンアップ継続（`P1-8`）の完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Continue cleaning up unused functions` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` から重複ローカル helper（`_resolve_imported_module_name_local` / `_resolve_attribute_owner_context_local`）を削除し、`CodeEmitter` 共通 helper（`resolve_attribute_owner_context`）へ統一した。
   - [x] C++ 固有の import エラー生成（`_make_missing_symbol_import_error`）や hook 経路は維持し、挙動を変えずに重複のみ削減した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: `emit_stmt` 制御構文の `syntax_*` テンプレート移管完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Template control-flow branches in emit_stmt and move them to CodeEmitter.syntax_*` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` の制御構文出力（`_emit_if_stmt` / `_emit_while_stmt` / `emit_for_range` / `emit_for_each` / `_emit_try_stmt`）が `syntax_line(...)` / `syntax_text(...)` 経路を使うことを確認した。
   - [x] `src/py2cpp.py` の `_emit_try_stmt` でブロック終端を `emit_block_close()` に統一し、scope-exit 終端も `syntax_text(\"scope_exit_close\", ... )` へ寄せたことを確認した。
   - [x] `src/profiles/cpp/syntax.json` に `scope_exit_close` テンプレートを追加した。
   - [x] `src/py2cpp.py` で未使用になっていた `_can_omit_braces_for_single_stmt` を削除した。
   - [x] `src/hooks/cpp/hooks/cpp_hooks.py` へ `_can_omit_braces_for_single_stmt` 相当の helper を追加し、brace 省略判定の挙動を維持した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: `FunctionDef/ClassDef` 共有テンプレート移管の完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Move shared templates for FunctionDef / ClassDef (open/body/close) into CodeEmitter` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/pytra/compiler/east_parts/code_emitter.py` に `emit_function_open` / `emit_class_open` / `emit_class_close` / `emit_block_close` / `emit_scoped_stmt_list` が実装済みであることを確認した。
   - [x] `src/py2cpp.py` から同名の C++ 側重複実装を削除し、`CodeEmitter` の共通実装へ一本化した。
   - [x] `src/py2cpp.py` の `emit_function` / `emit_class` が共通 open/close helper 呼び出しを維持していることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: `render_expr(Call/BinOp/Compare)` 分離タスクの完了反映

1. [x] `docs/todo.md` の `P1: CodeEmitter / Hooks Migration` にある `render_expr(Call/BinOp/Compare)` の hooks + helpers 分離タスクを完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` で `Call` / `BinOp` / `Compare` が `_render_call_expr_from_context` / `_render_binop_expr` / `_render_compare_expr` へ分離されていることを確認した。
   - [x] `src/py2cpp.py` の `render_expr` が `hook_on_render_expr_kind` を先に適用し、その後 helper 経路へ分配していることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。

## 2026-02-22 完了: C++ 固有差分（brace/range-mode）の hook 移管完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Override only C++-specific differences (brace omission, range-mode, etc.) in hooks` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/py2cpp.py` で `If` / `ForRange` / `For` の分岐に `hook_on_stmt_omit_braces(...)` / `hook_on_for_range_mode(...)` が使われていることを確認した。
   - [x] `src/hooks/cpp/hooks/cpp_hooks.py` で `on_stmt_omit_braces` / `on_for_range_mode` が登録されていることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。

## 2026-02-22 完了: `Constant/Name/Attribute` 共通描画の完了反映

1. [x] `docs/todo.md` の `P1: py2cpp Reduction` にある `Move base rendering of Constant(Name/Attribute) to shared CodeEmitter` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/pytra/compiler/east_parts/code_emitter.py` に `render_name_ref` / `render_constant_expr_common` / `render_attribute_expr_common` が実装済みであることを確認した。
   - [x] `src/py2cpp.py` で Name/Constant/Attribute が上記共通 helper 経由で描画されることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_py2cpp_codegen_issues`（`/workspace/Pytra/test/unit`）で `Ran 31 tests ... OK` を確認した。

## 2026-02-22 完了: `EmitterHooks` 実装項目の消化

1. [x] `docs/todo.md` の `P1: CodeEmitter / Hooks Migration` の `Implement hook injection (EmitterHooks)` を完了化した。
2. [x] 根拠確認を実施した。
   - [x] `src/pytra/compiler/east_parts/code_emitter.py` に `EmitterHooks` と hook 入口（`hook_on_emit_stmt_kind` / `hook_on_render_expr_leaf` / `hook_on_render_expr_complex`）が実装済みであることを確認した。
   - [x] `src/hooks/cpp/hooks/cpp_hooks.py` で `on_emit_stmt_kind` / `on_stmt_omit_braces` / `on_for_range_mode` / `on_render_expr_*` が登録済みであることを確認した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit`）で `Ran 33 tests ... OK` を確認した。

## 2026-02-22 完了: selfhost `CodeEmitter` classmethod スタブ削減

1. [x] `CodeEmitter` 本体を selfhost-safe な形へ寄せた。
   - [x] `src/pytra/compiler/east_parts/code_emitter.py` の `quote_string_literal` を `@staticmethod` 化した。
   - [x] `src/pytra/compiler/east_parts/code_emitter.py` の `load_profile_with_includes` を `@staticmethod` 化した。
   - [x] `load_profile_with_includes` の `include` 走査を `for item in includes_obj` から `list[Any]` + `while` に変更し、selfhost 変換後 C++ で `begin/end` 解決エラーが出ない形へ修正した。
2. [x] selfhost 専用パッチを1段削減した。
   - [x] `tools/prepare_selfhost_source.py` から `CodeEmitter` classmethod 用の置換関数（`_replace_misc_heavy_helpers_for_selfhost`）を削除した。
3. [x] 回帰確認を実施した。
   - [x] `PYTHONPATH=/workspace/Pytra/src python3 -m unittest -q test_code_emitter`（`/workspace/Pytra/test/unit` で実行）で `Ran 33 tests ... OK` を確認した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `selfhost/py2cpp.out sample/py/01_mandelbrot.py --dump-options -o /tmp/out.cpp` で options 詳細行出力を確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存どおり失敗（`.find` など receiver 欠落系）を確認した。

## 2026-02-22 完了: selfhost `dump_codegen_options_text` スタブ縮退

1. [x] `tools/prepare_selfhost_source.py` の `dump_codegen_options_text` を最小スタブ（`"options:\\n"` 固定返却）から置換した。
   - [x] selfhost-safe な等価実装（文字列連結ベース）へ変更し、`preset` / `negative-index-mode` / `opt-level` など詳細行を出力するようにした。
2. [x] 回帰確認を実施した。
   - [x] `python3 tools/build_selfhost.py` の成功を確認した。
   - [x] `selfhost/py2cpp.out sample/py/01_mandelbrot.py --dump-options -o /tmp/out.cpp` で `/tmp/out.cpp` 先頭に詳細 options 行が出ることを確認した。
   - [x] `python3 tools/build_selfhost_stage2.py --skip-stage1-build` は既存と同様に失敗（`.find` など receiver 欠落）することを確認した。

## 2026-02-22 完了: P4 `py2cs.py` EAST 移行

1. [x] `src/py2cs.py` を EAST ベースの薄い CLI へ置換した。
   - [x] `src/common/` 依存を撤去した。
2. [x] C# 固有処理を hook/profile へ分離した。
   - [x] `src/hooks/cs/`（`emitter` / `hooks`）を追加した。
   - [x] `src/profiles/cs/`（`types` / `operators` / `runtime_calls` / `syntax`）を追加した。
3. [x] 回帰確認導線を追加した。
   - [x] `test/unit/test_py2cs_smoke.py` を追加した。
   - [x] `tools/check_py2cs_transpile.py` を追加し、`checked=117 ok=117 fail=0 skipped=5` を確認した。

## 2026-02-22 完了: `docs-jp/todo.md` の P3/P4 一式消化

1. [x] `P3: py2rs（EAST移行）を CodeEmitter 中心で再設計` を完了した。
   - [x] `CodeEmitter` への共通化（`render_boolop_common` / `render_compare_chain_common` / `load_profile_with_includes` / `quote_string_literal`）を実施した。
   - [x] `py2rs` を EAST ベースで安定運用し、`tools/check_py2rs_transpile.py` で `checked=117 ok=117 fail=0 skipped=5` を確認した。
2. [x] `P4: 他言語トランスパイラの EAST 移行` を完了した。
   - [x] `py2go` / `py2java` / `py2ts` / `py2swift` / `py2kotlin` を EAST ベース CLI + preview emitter へ移行した。
   - [x] 各言語の smoke test と一括 transpile check を追加した。
3. [x] 言語横断回帰を追加した。
   - [x] `test/unit/test_error_classification_cross_lang.py` を追加し、`load_east` のエラー分類メッセージ整合を固定化した。
4. [x] `docs-jp/todo.md` を未完了専用の最小構成に整理した。

## 2026-02-22 完了: P0 Yanesdk（library + game）を py2cpp で通す最短経路

1. [x] `Yanesdk` 向け前処理方針を確定した。
   - [x] `from yanesdk import *` は wildcard import として受理し、変換器側で import メタを保持する方針にした。
   - [x] `# type:ignore` はコメントとして無視する方針にした（前処理での除去は不要）。
2. [x] `Yanesdk/docs/*/yanesdk.py` 重複配置の扱いを確定した。
   - [x] 調査/変換は canonical 正本 `Yanesdk/yanesdk/yanesdk.py` を優先する。
   - [x] 重複コピーは source を変更せず除外運用とした。
3. [x] 成功条件を達成した。
   - [x] `library 1本 + game 7本` が `py2cpp.py` を通ることを確認。
   - [x] `tools/check_yanesdk_py2cpp_smoke.py` を追加し、`checked=8 ok=8 fail=0` を確認。

## 2026-02-22 完了: P2 受け入れテスト追加（Yanesdk由来）

1. [x] 最小 fixture を追加・充足した。
   - [x] BOM付き `from ... import ...` (`test/fixtures/imports/bom_from_import.py`)
   - [x] `# type:ignore` 付き `from-import` (`test/fixtures/imports/type_ignore_from_import.py`)
   - [x] `**`（既存）
   - [x] `\` 行継続（既存）
   - [x] トップレベル式文（既存）
   - [x] class body `pass` (`test/fixtures/core/class_body_pass.py`)
   - [x] `yield`（既存）
   - [x] nested `def`（既存）
   - [x] `obj. attr` (`test/fixtures/core/obj_attr_space.py`)
   - [x] class 内 `X = 0,` (`test/fixtures/core/class_tuple_assign.py`)
2. [x] `tools/check_py2cpp_transpile.py` に Yanesdk 縮小ケース群（`--check-yanesdk-smoke`）を追加した。
3. [x] `Yanesdk` 実ファイル smoke テストを追加した（`tools/check_yanesdk_py2cpp_smoke.py`）。

## 2026-02-22 完了: P1-B import / module 解決（Yanesdk必須）

1. [x] `math` / `random` / `timeit` / `traceback` / `enum` / `typing` の取り扱い方針を統一した。
   - [x] `src/pytra/std/random.py` / `src/pytra/std/timeit.py` / `src/pytra/std/traceback.py` を追加した。
   - [x] 非修飾 import（`import random` など）を `pytra.std.*` 正規化で解決できる状態にした。
2. [x] `browser` / `browser.widgets.dialog` の `py2cpp` 側方針を確定した。
   - [x] `src/pytra/utils/browser/` と `src/pytra/utils/browser/widgets/dialog.py` shim を追加した。
   - [x] canonical 対象（`library 1本 + game 7本`）の `py2cpp` smoke を `checked=8 ok=8 fail=0` で確認した。
3. [x] import 仕様書へ重複配置除外ルールを明文化した。
   - [x] `docs-jp/spec-import.md` に `Yanesdk/docs/*/yanesdk.py` を重複コピーとして除外運用するルールを追記した。

## 2026-02-22 完了: P0-URGENT selfhost stage2 三項演算子破損（`(? : )`）修正

1. [x] 再現手順を固定し、`tools/build_selfhost.py` + `tools/build_selfhost_stage2.py` のフル再生成で検証する運用に統一した。
2. [x] 最小再現 fixture を追加した。
   - [x] `test/fixtures/control/ifexp_ternary_regression.py`
3. [x] `py2cpp.py` 側の if 式（`a if cond else b`）生成を調査し、selfhost 時に `render_expr` 静的束縛で `(? : )` が出る経路を特定した。
4. [x] C++ 生成を修正し、if 式専用経路（`_render_ifexp_expr`）を明示した。
5. [x] 回帰テストを追加した。
   - [x] `test/unit/test_py2cpp_codegen_issues.py` の `test_ifexp_ternary_is_rendered_in_all_expression_positions`
6. [x] `selfhost/py2cpp.out` で `py2cpp.py` 再変換後、stage2 バイナリ生成を確認した。
   - [x] `python3 tools/build_selfhost.py`
   - [x] `python3 tools/build_selfhost_stage2.py`
7. [x] stage2 バイナリで `sample/py` 全件を変換・コンパイル・実行し、Python 出力一致（実行時間行は除外）を確認した。
   - [x] `python3 tools/verify_selfhost_end_to_end.py --skip-build --selfhost-bin selfhost/py2cpp_stage2.out --cases sample/py/*.py`
   - [x] 結果: `failures=0`

## 2026-02-22 完了: P1-A self_hosted parser / tokenizer 拡張（Yanesdk必須）

1. [x] UTF-8 BOM（`\ufeff`）を先頭トークンとして許容した。
2. [x] バックスラッシュ継続行（`\`）を字句解析で扱えるようにした。
3. [x] べき乗演算子 `**` の構文解析と EAST 生成を追加した。
4. [x] トップレベル式文（module body の `Expr`）を受理した。
5. [x] class body の `pass` を受理した。
6. [x] `yield` / generator 構文（最小）を受理した。
   - [x] `Yield` ノードを追加し、関数内 `yield` を `is_generator` と `list[...]` 戻り型へ反映した。
   - [x] C++ 生成で `yield` を `list` への `append` + `return` に lower する最小経路を実装した。
7. [x] 関数内関数定義（nested `def`）を受理した。
8. [x] `obj. attr`（dot 前後に空白あり）を属性参照として受理した。
9. [x] class 内の末尾`,`付き代入（例: `X = 0,`）を tuple 代入として受理した。
10. [x] 文末 `;` は受理しない仕様へ変更し、エラー化した。
    - [x] `docs-jp/spec-user.md` に「文末 `;` 非対応」を追記した。
11. [x] 回帰テストを追加した。
    - [x] `test/unit/test_east_core.py` に BOM/継続行/`**`/top-level Expr/class `pass`/nested def/tuple末尾`,`/`yield`/`;` 拒否のテストを追加。
    - [x] `test/fixtures/control/yield_generator_min.py` を追加し、Python/C++ 実行一致（`True`）を確認。

## 2026-02-22 完了: DOCS-SYNC-01 `todo-history` 翻訳同期フロー整備

1. [x] `docs-jp/todo.md` の `ID: DOCS-SYNC-01` を完了した。
2. [x] `docs/todo-history/` の運用導線を整備した。
   - [x] `tools/sync_todo_history_translation.py` を追加し、`docs-jp/todo-history/YYYYMMDD.md` を基点に `docs/todo-history/YYYYMMDD.md` の不足ファイル雛形を自動生成できるようにした。
   - [x] 同スクリプトで `docs/todo-history/index.md` を自動更新し、日付別リンクと翻訳状態（`pending` / `done`）を可視化した。
   - [x] `python3 tools/sync_todo_history_translation.py --check` で file set の同期漏れ（missing/extra/index 欠落）を検出できるようにした。
3. [x] 文書ルールを同期した。
   - [x] `docs-jp/plans/docs-translation-sync.md` に日次運用手順（同期・翻訳・check・diff確認）を追記した。
   - [x] `docs-jp/spec-tools.md` / `docs/spec-tools.md` に新規ツールの目的を追記した。

## 2026-02-22 完了: `P1-MQ-08` ゴールデン比較運用への切替

1. [x] `docs-jp/todo.md` の `ID: P1-MQ-08` を完了した。
2. [x] `tools/verify_sample_outputs.py` をゴールデン運用へ切り替えた。
   - [x] 既定動作を `sample/golden/manifest.json` 参照 + C++ 実行結果比較（`stdout` / 生成物）に変更した。
   - [x] `--refresh-golden` / `--refresh-golden-only` / `--golden-manifest` を追加し、Python 実行は明示更新時のみ行う構成にした。
   - [x] 生成物比較を `suffix` / `size` / `sha256` で行い、ソース変更時は `source_sha256` で stale 検出するようにした。
3. [x] ゴールデン基準を追加した。
   - [x] `sample/golden/manifest.json` を追加し、`sample/py` 16件の基準出力（`stdout` / 生成物メタ）を保存した。
4. [x] 回帰確認を実施した。
   - [x] `python3 -m py_compile tools/verify_sample_outputs.py`
   - [x] `python3 tools/verify_sample_outputs.py --samples 01_mandelbrot 04_monte_carlo_pi --compile-flags=-O2`
   - [x] `python3 tools/verify_sample_outputs.py --samples 04_monte_carlo_pi --refresh-golden --refresh-golden-only`

## 2026-02-22 完了: `P1-COMP-06` / `P1-COMP-07` 責務境界の明文化

1. [x] `docs-jp/todo.md` の `ID: P1-COMP-06` と `ID: P1-COMP-07` を完了した。
2. [x] `CodeEmitter` と EAST parser の境界を仕様へ明文化した。
   - [x] `docs-jp/spec-dev.md` に「`CodeEmitter` は EAST -> コード生成に専念し、FS 依存の import 解決/プロジェクト解析を持たない」境界を追記した。
   - [x] `docs-jp/spec-dev.md` に「EAST parser は単一ファイル EAST 化に専念し、依存グラフ解析責務を持たない」境界を追記した。
   - [x] `docs-jp/spec-dev.md` に compiler 共通層（`src/pytra/compiler/`）が FS 依存解析を担当する責務分担を追記した。
3. [x] 文脈ファイルへ判断を反映した。
   - [x] `docs-jp/plans/p1-compiler-shared-extraction.md` の決定ログに、境界明文化完了を追記した。

## 2026-02-22 完了: `P1-COMP-08` 他言語 CLI の共通解析 API 移行計画作成

1. [x] `docs-jp/todo.md` の `ID: P1-COMP-08` を完了した。
2. [x] `docs-jp/plans/p1-compiler-shared-extraction.md` に移行計画を追加した。
   - [x] Phase 0: 共通解析 API の入口/戻り値スキーマ固定（`import_graph` / `module_east_map` / `symbol_index` / `type_schema` / `deps_dump`）。
   - [x] Phase 1: `py2rs.py` 先行適用。
   - [x] Phase 2: `py2cs.py` / `py2js.py` / `py2ts.py` へ展開。
   - [x] Phase 3: preview 言語（`go/java/swift/kotlin`）へ展開。
   - [x] Phase 4: 各 CLI から重複 project 解析コードを縮退。
3. [x] 完了条件を明文化した。
   - [x] 非 C++ CLI の共通 API 採用、`py2cpp.py` 側重複解析の撤去、既存 transpile チェック通過を完了条件として追記した。

## 2026-02-22 完了: `P1-RUNTIME-04` / `P1-RUNTIME-06` ランタイム配置統一の計画・運用ルール整備

1. [x] `docs-jp/todo.md` の `ID: P1-RUNTIME-04` と `ID: P1-RUNTIME-06` を完了した。
2. [x] `P1-RUNTIME-04` として、Rust以外言語の移行計画を追加した。
   - [x] `docs-jp/plans/p1-runtime-layout-unification.md` に、`src/{cs,js,ts,go,java,swift,kotlin}_module/` の資産マップと `src/runtime/<lang>/pytra/` への段階移行（Step A-D）を追記した。
   - [x] 完了条件（非Rust runtime の新配置統一、`py2*`/hooks の新配置基準化）を明記した。
3. [x] `P1-RUNTIME-06` として、運用ルールを明文化した。
   - [x] `docs-jp/plans/p1-runtime-layout-unification.md` に「`src/*_module/` は互換レイヤ専用」「新規 runtime 実体追加禁止」の運用ルールを追記した。
   - [x] `docs-jp/spec-codex.md` の配置ルールを `src/runtime/<lang>/pytra/` 基準へ更新し、`src/*_module/` の新規実体追加禁止を追記した。
   - [x] `docs-jp/spec-dev.md` / `docs-jp/pytra-readme.md` に移行方針（`runtime/` 正本、`*_module/` 旧配置）を反映した。
